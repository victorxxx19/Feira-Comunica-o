<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <style>
        body {
            padding-bottom: 80px;
            background-color: #f5f7fa; 
        }
        #divObjetos {
            max-width: 98%; margin: 20px auto; 
            padding: 0 10px; background-color: transparent;
            border: none; box-shadow: none;
        }
        
        /* --- Cabe√ßalho com Logo --- */
        .header-container {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding: 15px 20px;
            background-color: #ffffff; border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-bottom: 3px solid #37417c; 
        }
        .header-container h4 {
            font-size: 1.8rem; font-weight: 600; color: #37417c;
            display: flex; align-items: center; margin: 0;
        }
        .header-container h4 > i {
            font-size: 2.2rem; margin-right: 10px; color: #37417c;
        }
        .header-logo { max-height: 50px; width: auto; }
        .subtitulo-descricao {
            font-style: italic; color: #666; margin-left: 10px;
            margin-top: 5px; margin-bottom: 20px;
        }
        .secao-titulo {
            font-size: 1.5rem; font-weight: 600; color: #37417c; 
            margin: 30px 0 25px 5px; display: flex; align-items: center;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .secao-titulo i {
            font-size: 2rem; margin-right: 10px; color: #37417c;
        }
        
        /* --- Containers de Tabela (O "Card" Branco) --- */
        .tabela-container, .maquina-quadro, .batida-quadro {
            background-color: #ffffff; border-radius: 8px;
            overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        .mensagem-vazia {
            padding: 30px 20px; text-align: center; color: #666;
            font-style: italic; background-color: #f9f9f9;
            border-radius: 4px; margin: 20px;
        }

        /* --- Estilo das Tabelas --- */
        table.responsive-table { width: 100%; table-layout: fixed; }
        table thead { background: #37417c; }
        .batida-quadro table thead { background: #6A1B9A; } /* Roxo */
        
        table thead th {
            padding: 12px 8px !important; text-align: center !important;
            font-weight: 600 !important; color: #ffffff !important; 
            text-transform: uppercase; font-size: 0.75rem;
            letter-spacing: 0.5px; border-right: 1px solid rgba(255,255,255,0.1);
        }
        table thead th:last-child { border-right: none; }
        table tbody td {
            padding: 8px 6px !important; vertical-align: middle !important;
            text-align: center; color: #333; font-size: 0.85rem;
            border-bottom: 1px solid #e0e0e0; word-wrap: break-word; 
        }
        table tbody tr:hover { background-color: #f5f7fa !important; }

        /* --- Inputs e Selects dentro das tabelas --- */
        table .input-field {
            margin: 0 !important; padding: 0 !important;
            height: 100% !important;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            height: 40px !important; 
        }
        table .select-wrapper {
            margin-bottom: 0 !important; height: auto !important;
            min-height: 100%; display: flex;
            align-items: center; justify-content: center;
            width: 100%; 
        }
        table input[type="text"],
        table input[type="number"],
        table .select-wrapper input.select-dropdown {
            text-align: center !important; font-weight: 500;
            color: #333 !important; border-bottom: none !important;
            box-shadow: none !important; margin: 0 !important;
            height: auto !important; line-height: normal !important;
            font-size: 0.85rem !important; padding: 0 !important;
            box-sizing: border-box;
            width: 100% !important; 
        }
        table .select-wrapper .caret { display: none !important; }
        .dropdown-content li > span {
            text-align: center !important; display: block !important;
            color: #333 !important;
        }

        /* --- Colunas Tabela Superior ("Para Programar") --- */
        .col-pedido { width: 8%; cursor: pointer !important; font-weight:700 !important; }
        .col-data { width: 10%; }
        .col-cliente { width: 18%; }
        .col-descricao { width: 20%; }
        .col-status-atual { width: 12%; }
        .col-maquina { width: 15%; }
        .col-obs { width: 17%; }

        /* --- Colunas Tabela Inferior ("Fila das M√°quinas") --- */
        .col-fila-mq { width: 3%; } 
        .col-pedido-mq { width: 5%; }
        .col-data-mq { width: 9%; }
        .col-cliente-mq { width: 15%; }
        .col-descricao-mq { width: 20%; }
        .col-maquina-mq { width: 9%; } 
        .col-qtd-mq { width: 5%; }
        .col-metragem-mq { width: 6%; }
        .col-impressor-mq { width: 8%; }
        .col-status-mq { width: 13%; } 
        .col-acoes-mq { width: 7%; } 
        
        /* --- Colunas Tabela Batida (NOVO) --- */
        .col-pedido-batida { width: 10%; }
        .col-data-batida { width: 10%; }
        .col-cliente-batida { width: 25%; }
        .col-descricao-batida { width: 30%; }
        .col-faca-batida { width: 10%; }
        .col-status-batida { width: 15%; }

        /* --- Status de Data (Atrasado/Alerta) --- */
        .data-alerta { color: #FF9800 !important; font-weight: 600 !important; }
        .data-atrasada { color: #D32F2F !important; font-weight: 600 !important; }
        .data-status-icon {
            font-size: 1rem; vertical-align: middle; margin-left: 5px;
        }

        /* --- Status de Pedido (Cores) --- */
        .col-status-atual, .col-status-mq {
            text-align: center; font-weight: 600; 
            vertical-align: middle; padding: 8px 4px !important; 
        }
        .status-liberado-prod { background-color: #E8F5E9 !important; color: #2E7D32 !important; }
        .status-programado { background-color: #FFF9C4 !important; color: #F57F17 !important; }
        .status-setup { background-color: #E1F5FE !important; color: #0277BD !important; }
        .status-em-producao { background-color: #F3E5F5 !important; color: #6A1B9A !important; }
        .status-controlando { background-color: #E3F2FD !important; color: #1565C0 !important; }
        .status-aguardando-batida { background-color: #FFF9C4 !important; color: #F57F17 !important; }
        .status-na-expedicao { background-color: #E6F6E6 !important; color: #1B5E20 !important; }
        .status-concluido { background-color: #616161 !important; color: #FFFFFF !important; }
        
        /* <<< NOVOS STATUS (V4.5) >>> */
        .status-setup-digital { background-color: #E1F5FE !important; color: #0277BD !important; }
        .status-imprimindo-digital { background-color: #E0F7FA !important; color: #006064 !important; }
        .status-cortando-digital { background-color: #EDE7F6 !important; color: #311B92 !important; }
        .status-aguardando-corte-digital { background-color: #FFF9C4 !important; color: #F57F17 !important; }


        /* --- Estrutura dos Quadros de M√°quina --- */
        #quadros-maquinas-container { display: flex; flex-direction: column; gap: 30px; }
        .maquina-titulo {
            font-size: 1.2rem; font-weight: 600; color: #37417c;
            padding: 15px 20px; background: linear-gradient(135deg, #f5f7fa 0%, #e8ebf0 100%);
            border-bottom: 3px solid #37417c; text-transform: uppercase;
            display: flex; align-items: center; letter-spacing: 0.5px;
        }
        .maquina-titulo i { margin-right: 10px; color: #37417c; font-size: 1.5rem; }
        .quadro-corpo { padding: 0; overflow-x: auto; }
        .maquina-tabela {
            width: 100%; border-collapse: collapse;
            margin: 0; table-layout: fixed;
        }

        /* --- Controles de Fila (‚ñ≤ ‚ñº) --- */
       .fila-controles { display: flex; justify-content: center; align-items: center; }
       .btn-fila {
            background: none; border: none; padding: 2px 6px;
            margin: 0; line-height: 1; cursor: pointer;
            color: #37417c; font-size: 0.8rem; transition: all 0.2s;
            border-radius: 4px;
       }
       .btn-fila:hover:not(:disabled) { color: #1976D2; background-color: #E3F2FD; }
       .btn-fila:disabled { opacity: 0.3; cursor: not-allowed; color: #999; }
       .fila-numero { font-weight: 700; font-size: 0.8rem; color: #37417c; }

        /* --- Bot√µes de A√ß√£o (Play, Check, etc.) --- */
        .col-acoes-mq {
            text-align: center; padding: 0 5px !important; white-space: nowrap; 
        }
        .col-acoes-mq .btn-floating {
             margin: 0 3px; width: 32px; height: 32px; line-height: 32px;
        }
         .col-acoes-mq .btn-floating i {
             font-size: 1.2rem; line-height: 32px;
          }

        /* --- Rodap√© Fixo --- */
        #footer-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: #ffffff; border-top: 2px solid #37417c;
            padding: 15px 30px; display: flex;
            justify-content: flex-end; align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 999;
        }
         #footer-bar .btn {
            height: 45px; line-height: 45px;
            padding-left: 5px !important; padding-right: 20px !important;
            font-weight: 600; width: 250px !important; 
            flex-grow: 0; margin-left: 8px !important; 
         }
         #footer-bar .btn i { margin-left: -20px !important; }
        
        .btn-salvar { background: linear-gradient(135deg, #43A047 0%, #66BB6A 100%) !important; }
        .btn-salvar:disabled { background: #cccccc !important; box-shadow: none; }
        .divider {
            height: 2px;
            background: linear-gradient(to right, #37417c 0%, #C8E154 100%);
            margin: 40px 0; border: none;
        }

        /* --- Estilos dos Modais --- */
        .modal { border-radius: 12px !important; }
        .modal h4 { color: #37417c; font-weight: 600; }
        .modal .modal-footer .btn-flat { color: #E53935 !important; }
        .modal .modal-footer .btn { background-color: #37417c !important; }
        .modal .modal-footer .btn.green { background-color: #4CAF50 !important; }

        /* Estilo T√≠tulo do Modal (com linha gradiente) */
        #detalhes-pedido-modal h4, #modalConsumo h4, #modalMotivoConsumo h4,#modalAnilox h4 {
            border-bottom: 2px solid;
            border-image: linear-gradient(to right, #37417c, #C8E154) 1;
            padding-bottom: 15px; margin-bottom: 20px !important;
            font-size: 1.5rem !important; display: flex;
            align-items: center;
        }
        #modalConsumo h4 i, #modalAnilox h4 i {
            color: #37417c !important; margin-right: 10px;
        }
        
        /* Modal de Consumo Pequeno */
        #modalConsumo { max-width: 450px !important; }
        #consumo-grid-simples {
            display: flex; flex-direction: column;
            gap: 20px; margin-bottom: 20px;
        }
        .detalhes-pedido-label {
            font-size: 0.75rem; color: #666; text-transform: uppercase;
            font-weight: 600; letter-spacing: 0.5px; margin-bottom: 4px;
        }
        .detalhes-pedido-valor {
            font-size: 0.95rem; color: #000; font-weight: 500;
            padding: 8px 12px; background-color: #f5f7fa;
            border-radius: 6px; border: 2px solid #37417c;
        }
        #consumo-input-wrapper {
            padding: 8px 12px !important; background-color: #f5f7fa;
            border-radius: 6px; border: 2px solid #37417c;
            margin-top: 5px !important;
        }
        #consumo-input-wrapper input[type=number] {
            border-bottom: none !important; box-shadow: none !important;
            background-color: transparent !important; margin: 0 !important;
            height: 1.5rem !important; padding: 0 !important;
        }
        #consumo-input-wrapper label {
            transform: translateY(-160%) !important; position: relative !important;
            font-size: 0.75rem !important; color: #37417c !important;
            text-transform: uppercase !important; font-weight: 600 !important;
        }

        /* --- Modal de Detalhes (Layout) --- */
        #detalhes-pedido-modal { max-width: 1200px !important; width: 95% !important; max-height: 90% !important; }
        .detalhes-pedido-grid-3-col {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 12px 24px; margin-bottom: 20px;
        }
        .detalhes-pedido-item { display: flex; flex-direction: column; }
        .detalhes-pedido-valor {
             min-height: 38px; word-wrap: break-word;
        }
        .detalhes-pedido-item.full-width { grid-column: 1 / -1; }
        .detalhes-pedido-item.span-2 { grid-column: span 2; }
        .detalhes-pedido-secao {
            margin-top: 24px; padding-top: 20px; border-top: 1px solid #e0e0e0;
        }
        .detalhes-pedido-secao-titulo {
            font-size: 0.85rem; color: #37417c; text-transform: uppercase;
            font-weight: 700; letter-spacing: 0.5px; margin-bottom: 12px;
            display: flex; align-items: center;
        }
        .detalhes-pedido-secao-titulo i { margin-right: 8px; font-size: 1.1rem; }
        .detalhes-pedido-obs {
            background-color: #fff3cd; border: 2px solid #37417c;
            padding: 12px 16px; border-radius: 6px; color: #856404;
            font-size: 0.9rem; line-height: 1.5; white-space: pre-wrap;
            word-wrap: break-word;
        }
        .detalhes-pedido-obs.vazio {
            background-color: #f5f7fa;
            color: #999; font-style: italic;
        }
        .link-pedido {
            color: #0d47a1; font-weight: bold;
            cursor: pointer;
        }
        .link-pedido:hover { color: #1565c0; }


/* --- Modal Reportar Problema (V6.0 - Corrigido e Estilizado) --- */
#modalReportarProblema { 
    max-width: 800px !important; 
    border-radius: 12px !important; 
    overflow-x: hidden !important;
    overflow-y: auto !important;
    max-height: 90vh !important;
    padding-bottom: 20px;
}

/* Bot√£o X de fechar */
#modalReportarProblema .btn-close-x {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    transition: all 0.3s ease;
}

#modalReportarProblema .btn-close-x:hover {
    background-color: #f5f5f5;
}

#modalReportarProblema .btn-close-x i {
    color: #666;
    font-size: 24px;
}

#modalReportarProblema .btn-close-x:hover i {
    color: #37417c;
}

#modalReportarProblema h4 {
    border-bottom: 2px solid;
    border-image: linear-gradient(to right, #37417c, #C8E154) 1;
    padding-bottom: 15px; 
    margin-bottom: 30px !important;
    margin-top: 0 !important;
    font-size: 1.5rem !important; 
    display: flex;
    align-items: center;
}

#modalReportarProblema .modal-content {
    /* Diminui o padding inferior para dar espa√ßo ao footer sticky */
    padding: 24px 24px 24px 24px !important; 
    position: relative;
    overflow-y: auto;
    max-height: calc(90vh - 100px);
}

/* Espa√ßamento entre linhas e blocos */
#modalReportarProblema .row {
    margin-bottom: 25px !important; 
}


/* Espa√ßamento lateral nas colunas */
#modalReportarProblema .row .col {
    padding: 0 12px !important; 
}


#modalReportarProblema .input-field {
    padding: 0 !important;
    background-color: #f5f7fa !important;
    border-radius: 6px !important;
    border: 2px solid #37417c !important;
    min-height: 48px !important;
    max-height: 48px !important;
    height: 48px !important;
    display: flex !important;
    align-items: center !important;
    box-sizing: border-box !important;
    position: relative !important;
    margin-bottom: 0 !important;
    overflow: visible !important;
}


/* Textarea precisa de altura autom√°tica */
#modalReportarProblema .input-field:has(textarea) {
    height: auto !important;
    max-height: none !important;
    min-height: 100px !important;
}

#modalReportarProblema .input-field:focus-within {
    box-shadow: 0 0 0 2px rgba(55, 65, 124, 0.2);
}

/* üöÄ NOVO/CORRIGIDO: Labels ficarem em cima e vis√≠veis */
#modalReportarProblema .input-field > label {
  position: absolute;
  top: -20px !important; /* Posi√ß√£o acima do input-field container */
  left: 5px !important;
  color: #37417c !important;
  font-size: 0.75rem;
  font-weight: 600;
  background-color: transparent; 
  display: block; 
  transform: none !important;
  padding: 0 5px;
  line-height: normal;
}

/* Select wrapper */
#modalReportarProblema .input-field .select-wrapper {
    padding: 0 0 0 12px !important;
    margin: 0 !important;
    width: 100%;
    min-height: 48px; 
    height: 100%;
    display: flex;
    align-items: center;
}

/* Inputs de texto e select */
#modalReportarProblema .input-field input.select-dropdown,
#modalReportarProblema .input-field input[type=text] {
    height: 44px !important;
    line-height: 44px !important;
    padding: 0 10px !important;
    border-bottom: none !important; 
    box-shadow: none !important;    
    margin: 0 !important;
    font-size: 0.95rem !important;
    font-weight: 500 !important;
    color: #000 !important;
    background-color: transparent !important; 
    width: 100% !important;
}

/* Textarea */
#modalReportarProblema .input-field textarea.materialize-textarea {
    height: auto !important;
    min-height: 100px !important;
    line-height: 1.5 !important;
    padding: 12px 10px !important;
    border-bottom: none !important;
    box-shadow: none !important;
    margin: 0 !important;
    font-size: 0.95rem !important;
    font-weight: 500 !important;
    color: #000 !important;
    background-color: transparent !important;
}

/* Seta do select */
#modalReportarProblema .input-field .caret {
    display: block !important;
    fill: #37417c !important;
    right: 8px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
}

#modalReportarProblema .input-field .select-wrapper input.select-dropdown {
    padding-right: 30px !important; 
}

/* Bloco de detalhes do pedido */
#bloco_detalhes_pedido {
    border-left: 5px solid #4CAF50;
    background-color: #f5f5f5;
    padding: 20px 15px;
    border-radius: 6px;
    margin-bottom: 25px; 
}

#bloco_detalhes_pedido h5 {
    color: #4CAF50;
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 15px;
    margin-top: 0;
}

#bloco_detalhes_pedido .row {
    margin-bottom: 0 !important;
}

#bloco_detalhes_pedido .detalhes-pedido-item {
    margin-bottom: 0 !important;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

#bloco_detalhes_pedido .detalhes-pedido-label {
    font-size: 0.75rem; 
    color: #37417c; 
    font-weight: 600;
    text-transform: uppercase;
}

#bloco_detalhes_pedido .detalhes-pedido-valor {
    padding: 8px 10px;
    font-size: 0.9rem;
    font-weight: 600;
    background-color: #fff;
    border-radius: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
}

/* Blocos de problema */
#bloco_cliche,
#bloco_faca {
    border-top: 2px solid #e0e0e0;
    padding-top: 25px;
    margin-top: 20px;
}

/* T√≠tulo do bloco Clich√™ com o ID do Clich√™ */
#problema_cliche_titulo_id,
#problema_faca_titulo_id {
    color: #37417c;
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 15px;
    margin-top: 10px;
}

/* Info display da faca */
#faca_info_display {
    margin-bottom: 20px;
    background: #f9f9f9;
    padding: 12px 15px;
    border-radius: 6px;
    font-size: 0.9rem;
    border: 1px solid #e0e0e0;
    color: #37417c;
}

/* üöÄ NOVO/CORRIGIDO: Rodap√© do modal sticky (fixo no fundo do modal) */
#modalReportarProblema .modal-footer {
    /* üõë ATEN√á√ÉO: Mudan√ßa para FIXED */
    position: fixed; 
    bottom: 0;
    left: auto; /* Deixa o Materialize centralizar horizontalmente */
    width: 100%;
    max-width: 800px; /* Limita a largura ao tamanho m√°ximo do modal */
    
    background-color: #fff;
    border-top: 2px solid #e0e0e0;
    /* Garante o espa√ßamento interno, incluindo o padding inferior */
    padding: 15px 24px !important; /* Um pouco menos de padding vertical */
    display: flex;
    justify-content: flex-end;
    align-items: center; 
    gap: 12px;
    z-index: 100; /* Z-index alto para ficar acima de tudo */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);

    /* üöÄ NOVO: Corrigir a centraliza√ß√£o horizontal do fixed footer (Materialize) */
    transform: translateX(-50%);
    left: 50%;
}


/* Bot√µes do rodap√© */
#modalReportarProblema .modal-footer .btn {
    flex-shrink: 0;
    min-width: 140px;
}

/* Bot√£o confirmar desabilitado - totalmente cinza */
#btnConfirmarReporteProblema:disabled {
    background-color: #9e9e9e !important;
    color: #e0e0e0 !important;
    cursor: not-allowed !important;
    opacity: 0.6 !important;
}

#btnConfirmarReporteProblema:disabled i {
    color: #e0e0e0 !important;
}

        #modalAnilox .secao-titulo {
            text-transform: none !important;
        }
    
        #modalAnilox .modal-content {
            max-height: calc(100% - 70px);
            height: auto;
            overflow-y: auto;
            padding-bottom: 30px !important;
        }

        /* 1. Estilo base para os inputs do MODAL - CR√çTICO: Borda azul no CONTAINER! */
        #modalAnilox .input-field {
            margin: 0 !important;
            padding: 0 !important;
            background-color: #f5f7fa !important;
            border-radius: 6px !important;
            border: 2px solid #37417c !important; /* A borda azul est√° aqui no container */
            border-bottom: none !important;
            min-height: 38px !important;
            height: auto !important;
            display: flex !important;
            align-items: center !important;
            box-sizing: border-box !important;
        }
        #modalAnilox .input-field:focus-within {
            box-shadow: 0 0 0 1px #37417c;
        }

        /* 2. Ajusta o select-wrapper interno (sem bordas internas) */
        #modalAnilox .input-field .select-wrapper {
            padding: 0 0 0 12px !important;
            margin: 0 !important;
            width: 100%;
            height: 38px;
            display: flex;
            align-items: center;
        }

        /* 3. Remove BORDAS do input.select-dropdown dentro do input-field */
        #modalAnilox .input-field input.select-dropdown {
            border-bottom: none !important; /* Remove borda do Materialize */
            box-shadow: none !important;    /* Remove sombra do Materialize */
            margin: 0 !important;
            height: 38px !important;
            line-height: 38px !important;
            font-size: 0.95rem !important;
            font-weight: 500 !important;
            color: #000 !important;
            background-color: transparent !important; /* Evita fundo duplicado */
            padding: 0 10px 0 0 !important; /* Ajusta padding para o caret */
        }

        /* 4. Posiciona a seta (mantido) */
        #modalAnilox .input-field .caret {
            display: block !important;
            fill: #37417c !important;
            right: 8px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
        }

        /* --- Se√ß√£o 1: Faca --- */
        #anilox_faca_item_wrapper {
            border: 2px solid #37417c;
            border-radius: 8px;
            padding: 15px 15px 5px 15px; /* Ajustado padding-bottom */
            margin-top: 20px;
            margin-bottom: 25px;
        }
        #anilox_faca_item_wrapper h5 {
            color: #37417c;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px !important;
            margin-top: 0;
        }
        /* Alinhamento do Modelo da Faca e Item da Faca */
        #anilox_faca_item_wrapper .row {
            margin-bottom: 10px !important; /* Margem inferior dentro da box da faca */
            align-items: flex-end; /* Alinha os itens na parte inferior */
        }
        #anilox_faca_item_wrapper .detalhes-pedido-item {
            /* Estilo para o MODELO DA FACA */
            margin-bottom: 0 !important;
        }
        #anilox_faca_item_wrapper .detalhes-pedido-item .input-field {
            /* Remove a borda azul e fundo para o campo de FACA MODELO, que √© apenas um SPAN */
            border-left: none !important;
            background-color: transparent !important;
            box-shadow: none !important;
        }

        /* Estilo para o campo de SELECT Item da Faca */
        #anilox_faca_item_wrapper .input-field.item-faca-select {
            position: absolute !important;
            top: 238px !important;
            border: 2px solid #37417c !important; /* Aplica a borda azul ao input-field do select */
            background-color: #f5f7fa !important;
            box-shadow: none !important;
        }
        #anilox_faca_item_wrapper .input-field.item-faca-select label {
            position: absolute !important;
            transform: none !important;
            left: 5px !important;
            top: -20px !important;
            font-size: 0.75rem !important;
            color: #555 !important;
            font-weight: 600 !important;
            display: block;
            margin-bottom: 5px;
        }
        #anilox_faca_item_wrapper .input-field.item-faca-select .select-wrapper {
            padding: 0 0 0 12px !important;
        }
        #anilox_faca_item_wrapper .input-field.item-faca-select input.select-dropdown {
            background-color: transparent !important; /* Garante que o input interno seja transparente */
        }

        #anilox-estacoes-wrapper .input-field {
        margin: 0 !important;
        padding: 0 !important;
        background-color: #f5f7fa !important;
        border-radius: 6px !important;
        border: 2px solid #37417c !important; 
        border-bottom: 2px solid #37417c !important;
        min-height: 44px !important; /* AUMENTADO PARA EVITAR CORTE */
        height: auto !important;
        display: flex !important;
        align-items: center !important;
        box-sizing: border-box !important;
    }
    #anilox-estacoes-wrapper .input-field:focus-within {
        box-shadow: 0 0 0 1px #37417c;
    }

    /* Ajuste o select-wrapper interno para a nova altura */
    #anilox-estacoes-wrapper .input-field .select-wrapper {
        padding: 0 0 0 12px !important;
        margin: 0 !important;
        width: 100%;
        min-height: 40px; 
        height: 100%;
        display: flex;
        align-items: center;
    }
    /* Ajuste a altura do input/select-dropdown interno */
    #anilox-estacoes-wrapper .input-field input.select-dropdown,
    #anilox-estacoes-wrapper input[type=text] {
        height: 40px !important;
        line-height: 40px !important;
    }


        /* 6. Estilo para o campo de Pantone (Input de Texto) - SEM BORDAS DUPLICADAS */
        #anilox-estacoes-wrapper input[type=text] {
            border: none !important; /* Remove bordas do input real */
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 10px !important;
            height: 40px !important;
            box-sizing: border-box;
            font-size: 0.95rem !important;
            font-weight: 500 !important;
            color: #000 !important;
            background-color: transparent !important; /* O fundo √© do input-field container */
            border-radius: 6px !important; /* Arredondamento √© do container */
            border-left: none !important; /* ESSENCIAL: remove a borda azul do input real */
            width: 100% !important;
        }
        #anilox-estacoes-wrapper input[type=text]:focus {
            box-shadow: none !important; /* A sombra de foco vem do parent .input-field:focus-within */
        }

        /* 7. Alinhamento das linhas de cor/anilox */
        .anilox-cor-row {
            min-height: 45px !important;
            height: auto !important;
            margin-bottom: 15px !important;
            margin-top: 15px !important;
            margin-left: 0;
            margin-right: 0;
            display: flex; /* Usar flex para alinhar o label com os inputs */
            align-items: center;
            z-index: 0 !important;
        }
        
        .anilox-label {
            font-weight: 600;
            color: #37417c;
            font-size: 0.95rem;
            padding-right: 5px;
            text-align: right;
            box-sizing: border-box;
            line-height: 38px;
            flex-shrink: 0; /* N√£o encolher */
            width: 100%; /* Ocupa a largura total da sua col */
        }
        /* 9. Corrige o "estouro" da lista de op√ß√µes (Manter) */
        body > .dropdown-content {
            max-height: 300px !important; 
            overflow-y: auto !important; 
        }
        </style>
</head>

<body>

    <div id="toast-custom-container" 
            style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 10000;">
    </div>

    <div id="divObjetos">
        
        <div class="header-container">
            <h4><i class="material-icons">analytics</i> Controle de Produ√ß√£o</h4>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAADICAYAAADGFbfiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEumlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTExLTA0PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPjcyMDNmNjM2LTRhNmUtNDkzZi04MGZlLWE0NWRhNjljNTJmZDwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5EZXNpZ24gc2VtIG5vbWUgLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlv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" alt="Logo Feira" class="header-logo">
        </div>

        <h4 class="secao-titulo">
            <i class="material-icons">inbox</i> Para Programar
        </h4>
        <p class="subtitulo-descricao">
            Pedidos de impress√£o que ainda n√£o foram designados para uma m√°quina.
        </p>
        
        <div id="tabela-programar-container" class="tabela-container">
            <table id="tabela-programar" class="striped highlight responsive-table">
                <thead>
                    <tr>
                        <th class="col-pedido">N¬∫ PEDIDO</th>
                        <th class="col-data">DATA ENTREGA</th>
                        <th class="col-cliente">CLIENTE</th>
                        <th class="col-descricao">DESCRI√á√ÉO</th>
                        <th class="col-status-atual">STATUS</th>
                        <th class="col-maquina">M√ÅQUINA</th>
                        <th class="col-obs">OBSERVA√á√ÉO - PCP</th>
                    </tr>
                </thead>
                <tbody id="tabela-programar-corpo"></tbody>
            </table>
            <p id="msg-sem-pedidos" class="mensagem-vazia" style="display: none;">
                N√£o h√° novos pedidos liberados para produ√ß√£o.
            </p>
        </div>

        <div class="divider"></div>

        <h4 class="secao-titulo">
            <i class="material-icons">view_column</i> Fila de Impress√£o (Flexo e Digital)
        </h4>
        
        <div id="quadros-maquinas-container">
            </div>
        <p id="msg-sem-maquinas" class="mensagem-vazia" style="display: none;">
            Nenhum pedido programado nas m√°quinas de impress√£o.
        </p>

        <div class="divider"></div>

        <h4 class="secao-titulo">
            <i class="material-icons">content_cut</i> Fila de Acabamento (Batida)
        </h4>
        <div id="quadro-batida-container" class="batida-quadro">
            <table id="tabela-batida" class="maquina-tabela highlight">
                <thead>
                    <tr>
                        <th class="col-pedido-batida">N¬∫ PEDIDO</th>
                        <th class="col-data-batida">DATA ENTREGA</th>
                        <th class="col-cliente-batida">CLIENTE</th>
                        <th class="col-descricao-batida">DESCRI√á√ÉO</th>
                        <th class="col-faca-batida">FACA</th>
                        <th class="col-status-batida">STATUS</th>
                        <th class="col-acoes-mq">A√á√ÉO</th>
                    </tr>
                </thead>
                <tbody id="tabela-batida-corpo"></tbody>
            </table>
            <p id="msg-sem-batida" class="mensagem-vazia" style="display: none;">
                Nenhum pedido aguardando acabamento na Batida.
            </p>
        </div>
        
    </div> 
    
    <div id="footer-bar">
           <button class="btn waves-effect waves-light red darken-2" onclick="abrirModalReportarProblema()">Reportar Problema<i class="material-icons right">report_problem</i></button>
           <button id="btnSalvar" class="btn waves-effect btn-salvar" disabled>Salvar Altera√ß√µes<i class="material-icons right">save</i></button>
    </div>

    <div id="motivo-atraso-modal" class="modal">
        <div class="modal-content">
            <h4><i class="material-icons left red-text">error_outline</i>Pedido Atrasado!</h4>
            <p>Voc√™ est√° concluindo um pedido com a <strong>Data de Entrega Vencida</strong>. Por favor, informe o <strong>motivo do atraso</strong> para prosseguir.</p>
            <div class="input-field">
                <textarea id="motivoAtrasoInput" class="materialize-textarea"></textarea>
                <label for="motivoAtrasoInput">Motivo do Atraso (Obrigat√≥rio)</label>
            </div>
        </div>
        <div class="modal-footer">
            <button id="motivoAtrasoCancelar" class="modal-close waves-effect waves-grey btn-flat">Cancelar</button>
            <button id="motivoAtrasoConfirmar" class="waves-effect waves-green btn green" disabled>Confirmar Conclus√£o</button>
        </div>
    </div>

    <div id="modalConsumo" class="modal"> 
        <div class="modal-content">
            <h4><i class="material-icons left">straighten</i>Registrar Metragem Produzida</h4>
            <div id="consumo-grid-simples"> 
                <div class="detalhes-pedido-item">
                    <span class="detalhes-pedido-label">N¬∞ Pedido</span>
                    <span id="consumo_numPedido" class="detalhes-pedido-valor">---</span>
                </div>
                <div class="detalhes-pedido-item">
                    <span class="detalhes-pedido-label">Impressor</span>
                    <span id="consumo_impressor" class="detalhes-pedido-valor">---</span>
                </div>
                <div class="detalhes-pedido-item full-width"> 
                    <div class="input-field" id="consumo-input-wrapper">
                        <input id="consumo_metragem_total" type="number" step="0.01">
                        <label for="consumo_metragem_total" class="detalhes-pedido-label">Metragem Total Consumida (m)</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-close waves-effect waves-grey btn-flat">Cancelar</button>
            <button class="btn waves-effect green" id="btnConfirmarConsumo" onclick="registrarConsumo()">
            Confirmar Consumo
            <i class="material-icons right">check</i>
            </button>
        </div>
    </div>

    <div id="modalMotivoConsumo" class="modal">
        <div class="modal-content">
            <h4><i class="material-icons left red-text">trending_up</i> Justificar Metragem Excessiva</h4>
            <p>A metragem consumida (**<span id="motivo_metragem_consumida">---</span> m**) excede em mais de 10% a metragem programada para o Pedido **<span id="motivo_numPedido">---</span>**.</p>
            <p><strong>Por favor, descreva o motivo do consumo excessivo:</strong></p>
            <div class="input-field">
                <textarea id="motivoConsumoInput" class="materialize-textarea" placeholder="Ex: Problema no substrato, perda de registro..."></textarea>
                <label for="motivoConsumoInput">Motivo do Consumo Excessivo (Obrigat√≥rio)</label>
            </div>
        </div>
        <div class="modal-footer">
            <button id="motivoConsumoCancelar" class="modal-close waves-effect waves-grey btn-flat">Cancelar</button>
            <button id="motivoConsumoConfirmar" class="waves-effect waves-green btn red" disabled>Confirmar Consumo Alto</button>
        </div>
    </div>

<div id="modalReportarProblema" class="modal"> 
    <div class="modal-content"> 
        <a href="#!" class="modal-close btn-close-x"><i class="material-icons">close</i></a>
        
        <h4 id="problema-titulo"><i class="material-icons">report_problem</i>  Reportar Problema</h4> 
        <div class="gradient-line"></div>

        <div class="row">
            <div class="input-field col s12">                
                <input id="problema_numPedido" type="text" class="validate">
                <label for="problema_numPedido">1. Informe o N¬∫ do Pedido</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">                
                <select id="problema_ferramenta">
                    <option value="" disabled selected>Selecione o Insumo</option>
                    <option value="Clich√™">Clich√™</option>
                    <option value="Faca">Faca</option>
                    <option value="Ambos">Ambos</option>
                </select>
                <label for="problema_ferramenta">2. Selecione a Ferramenta com Problema</label>
            </div>
        </div>
        
        <div id="bloco_detalhes_pedido" style="display: none;">
            <h5>
                ‚úÖ Pedido Encontrado: <span id="detalhes_pedido_num"></span>
            </h5>
            
            <div class="row">
                <div class="col s4 detalhes-pedido-item">
                    <span class="detalhes-pedido-label">Cliente</span>
                    <span id="detalhes_pedido_cliente" class="detalhes-pedido-valor">---</span>
                </div>
                <div class="col s4 detalhes-pedido-item">
                    <span class="detalhes-pedido-label">Descri√ß√£o</span>
                    <span id="detalhes_pedido_descricao" class="detalhes-pedido-valor">---</span>
                </div>
                <div class="col s4 detalhes-pedido-item">
                    <span class="detalhes-pedido-label">Status Atual</span>
                    <span id="detalhes_pedido_status" class="detalhes-pedido-valor">---</span>
                </div>
            </div>
        </div>

        <div id="bloco_cliche" style="display: none; border-top: 1px solid #eee; padding-top: 15px;">
            <h5 style="color: #37417c; font-weight: 600; font-size: 1.0rem; margin-bottom: 20px; margin-top: 10px;">Problema no Clich√™</h5>
            <div id="cliche_info_display" style="margin-bottom: 20px; background: #f9f9f9; padding: 12px 15px; border-radius: 6px; font-size: 0.9rem; border: 1px solid #e0e0e0; color: #37417c;">
                <strong>ID Clich√™:</strong> <span id="cliche_id_display">---</span>
            </div>
            <div class="row">
                <div class="input-field col s12">                    
                    <select multiple id="problema_id_lamina">
                        <option value="" disabled>Buscando l√¢minas...</option>
                    </select>
                    <label>3a. Selecione as L√¢minas Afetadas (ou deixe em branco para Jogo Inteiro)</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">                    
                    <select id="problema_tipo_cliche">
                        <option value="" disabled selected>Escolha o Tipo de Problema</option>
                    </select>
                    <label for="problema_tipo_cliche">3b. Tipo de Problema no Clich√™</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">                    
                    <textarea id="problema_descricao_cliche" class="materialize-textarea"></textarea>
                    <label for="problema_descricao_cliche">3c. Descreva o Problema (Obrigat√≥rio)</label>
                </div>
            </div>
        </div>

        <div id="bloco_faca" style="display: none;">
            <h5 style="color: #37417c; font-weight: 600; font-size: 1.0rem; margin-bottom: 20px; margin-top: 10px;">Problema na Faca</h5>
            <div id="faca_info_display">
                <strong>Modelo Faca:</strong> <span id="faca_modelo_display">---</span> | 
                <strong>Item:</strong> <span id="faca_id_unico_display">---</span>
            </div>
            <div class="row">
                <div class="input-field col s12">                    
                    <select id="problema_tipo_faca">
                        <option value="" disabled selected>Escolha o Tipo de Problema</option>
                    </select>
                    <label for="problema_tipo_faca">4a. Tipo de Problema na Faca</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">                    
                    <textarea id="problema_descricao_faca" class="materialize-textarea"></textarea>
                    <label for="problema_descricao_faca">4b. Descreva o Problema (Obrigat√≥rio)</label>
                </div>
            </div>
        </div>

        <div id="problema_loading" style="text-align: center; padding: 20px; display: none;">
            <div class="preloader-wrapper active">
              <div class="spinner-layer spinner-blue-only">
                <div class="circle-clipper left"><div class="circle"></div></div>
                <div class="gap-patch"><div class="circle"></div></div>
                <div class="circle-clipper right"><div class="circle"></div></div>
              </div>
            </div>
            <p>Buscando dados do pedido...</p>
        </div>
        
    </div>
    <div class="modal-footer">
        <button class="btn waves-effect waves-light blue darken-1" id="btnReiniciarReporte" onclick="reiniciarModalReporte()">
            <i class="material-icons left">refresh</i>Reiniciar
        </button>
        <button class="btn waves-effect red darken-2" id="btnConfirmarReporteProblema" onclick="confirmarReporteProblema()" disabled>
            Confirmar Problema
            <i class="material-icons right">check</i>
        </button>
    </div>
</div>

<div id="detalhes-pedido-modal" class="modal">
        <div class="modal-content">
            <h4 id="detalhes-titulo">Detalhes do Pedido</h4>
            <div id="detalhes-loading" style="text-align: center; padding: 40px;">
                <div class="preloader-wrapper active">
                  <div class="spinner-layer spinner-blue-only">
                    <div class="circle-clipper left"><div class="circle"></div></div>
                    <div class="gap-patch"><div class="circle"></div></div>
                    <div class="circle-clipper right"><div class="circle"></div></div>
                  </div>
                </div>
                <p>Buscando dados...</p>
            </div>
            <div id="detalhes-conteudo" style="display: none;">
                <div class="detalhes-pedido-grid-3-col">
                    </div>
                </div>
            </div>
        <div class="modal-footer">
            <button class="modal-close waves-effect waves-grey btn-flat">Fechar</button>
        </div>
    </div>

<div id="modalAnilox" class="modal" style="max-width: 800px !important;">
    <div class="modal-content">
        <h4><i class="material-icons left">settings</i>Iniciar Setup e Definir Anilox</h4>

        <div class="detalhes-pedido-grid-3-col">
            <div class="detalhes-pedido-item">
                <span class="detalhes-pedido-label">N¬∞ Pedido</span>
                <span id="anilox_numPedido" class="detalhes-pedido-valor">---</span>
            </div>
            <div class="detalhes-pedido-item">
                <span class="detalhes-pedido-label">C√≥d. Produto</span>
                <span id="anilox_codProduto" class="detalhes-pedido-valor">---</span>
            </div>
            <div class="detalhes-pedido-item">
                <span class="detalhes-pedido-label">Impressor</span>
                <span id="anilox_impressor" class="detalhes-pedido-valor">---</span>
            </div>
        </div>

        <div id="anilox_faca_item_wrapper">
            <h5>1. Sele√ß√£o da Faca</h5>
            <div class="row"> <div class="col s12 m4 detalhes-pedido-item">
                    <span class="detalhes-pedido-label">Modelo da Faca</span>
                    <span id="anilox_faca_modelo" class="detalhes-pedido-valor" style="background-color: #f0f0f0;">---</span>
                </div>
                
                <div class="col s12 m8" style="display: flex; flex-direction: column; justify-content: flex-end;">
                    <div class="input-field item-faca-select"> <label for="anilox_faca_item">SELECIONE A FACA</label>
                        <select id="anilox_faca_item">
                            <option value="" disabled selected>Buscando facas...</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <h5 class="secao-titulo" style="font-size: 1.1rem !important; border-top: 1px solid #eee; padding-top: 20px; margin-bottom: 35px !important; margin-top: 25px !important; display: flex; justify-content: space-between; align-items: center;">
            2. Defini√ß√£o de Anilox/L√¢minas
            <a id="anilox-unlock-btn" href="#!" class="btn-flat waves-effect" style="display:none; color: #D32F2F; font-size: 0.8rem; padding: 0 10px;">
                <i class="material-icons left" style="font-size: 1rem; margin-right: 4px;">lock_open</i>Alterar
            </a>
        </h5>

        <div id="anilox-estacoes-wrapper">
            <div id="anilox-loading" style="text-align: center; padding: 15px; margin-top: 10px;">
                <div class="preloader-wrapper active"></div> <p>Buscando Ficha T√©cnica...</p>
            </div>
        </div>
    </div>

    <div class="modal-footer" style="background-color: #ffffff; border-top: 1px solid #eee;">
        <button class="modal-close waves-effect waves-grey btn-flat">Cancelar</button>
        <button class="btn waves-effect green" id="btnConfirmarSetup" onclick="onSalvarAnilox()">
            Salvar e Iniciar Setup
            <i class="material-icons right">check</i>
        </button>
    </div>
  </div>

  <div id="modalConsumirSobra" class="modal" style="max-width: 500px;"> 
    <div class="modal-content">
        <h4><i class="material-icons left">inventory_2</i>Consumir Estoque de Sobra</h4>
        <p>Registrar o consumo de sobras para o Produto: <strong id="sobra-cod-produto">---</strong></p>
        <div class="detalhes-pedido-item" style="margin-top: 15px;">
            <span class="detalhes-pedido-label">Saldo Atual em Estoque</span>
            <span id="sobra-saldo-atual" class="detalhes-pedido-valor" style="font-size: 1.2rem; font-weight: bold;">---</span>
        </div>
        <div class="input-field" style="margin-top: 20px;">
            <input id="sobra-qtd-consumir" type="number" step="1">
            <label for="sobra-qtd-consumir">Qtd. a Consumir (Baixar do Estoque)</label>
        </div>
        <input type="hidden" id="sobra-num-pedido">
    </div>
    <div class="modal-footer">
        <button class="modal-close waves-effect waves-grey btn-flat">Cancelar</button>
        <button class="btn waves-effect green" id="btn-confirmar-consumo-sobra">
           Confirmar Consumo
        </button>
    </div>
</div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
    <script>
        // Carrega os dados iniciais injetados pelo backend
        var dadosServidor = <?!= JSON.stringify(dados) ?>;
    </script>
    
    <script>
    // ===============================================
    // CONTROLE DE PRODU√á√ÉO - JAVASCRIPT v4.6 (Roteiro Digital)
    // ===============================================

    // --- Vari√°veis Globais ---
    let todosPedidos = [];
    let listaMaquinas = [];
    let listaFornecedores = [];
    let listaImpressores = [];
    let listaAnilox = []; 
    let mudancas = {}; 
    let modalDetalhesInstance, consumoModalInstance, modalMotivoConsumoInstance, 
    modalAtrasoInstance, modalAniloxInstance;
    let modalConsumirSobraInstance;
    let problemaModalInstance; // <<<< NOVO: Inst√¢ncia do modal de problema
    let dadosInsumosReporte = null; // <<<< NOVO: Vari√°vel para dados do reporte
    let problemaNumPedidoInput, problemaFerramentaSelect, problemaBtnConfirm;
    let quadrosContainer = null; // <-- ADICIONE ESTA LINHA OU VERIFIQUE SUA EXIST√äNCIA
    let batidaContainer = null; // <-- ADICIONE ESTA LINHA OU VERIFIQUE SUA EXIST√äNCIA
    let tabelaCorpo = null;
    let setupLinhaPlanilha = null;
    let setupCodProduto = null;
    let setupQtdCores = 0;
    const ORDEM_MAQUINAS = ["Superprint 250", "Etirama Fit", "Kromia I", "Kromia II", "Flexo Digital"]; // Adicionada Digital

    // Lista de Cores/L√¢minas (Edite esta lista se precisar de mais op√ß√µes)
    var listaCoresLaminas = [
    "CMYK - Ciano", "CMYK - Magenta", "CMYK - Amarelo", "CMYK - Preto",
    "Branco", "Pantone", "Ouro", "Prata","Reflex Blue", "Orange 021",
    "Verniz Brilho", "Verniz Fosco", "Reserva de Verniz",
    "Lamina√ß√£o Brilho", "Lamina√ß√£o Fosca",
    "Cold Ouro", "Cold Prata",
    "Neutra"
];

    // <<< CORRE√á√ÉO V4.6 >>>
    // Op√ß√£o padr√£o para todos os dropdowns do Materialize
    const materializeSelectOptions = {
        dropdownOptions: { container: document.body }
    };


function abrirModalConsumirSobra(numPedido, codProduto, obsPCP) {
¬† console.log("üîß Abrindo modal Sobra:", {numPedido, codProduto, obsPCP}); // Debug
¬†¬†
¬† const match = obsPCP.match(/Usar (\d+)/i);
¬† const qtdSugerida = match ? match[1] : 0;

¬† if (modalAniloxInstance && modalAniloxInstance.isOpen) modalAniloxInstance.close();
¬† if (consumoModalInstance && consumoModalInstance.isOpen) consumoModalInstance.close();

  // 1. Preenche os dados no modal (enquanto ele est√° invis√≠vel)
¬† document.getElementById('sobra-num-pedido').value = numPedido;
¬† document.getElementById('sobra-cod-produto').textContent = codProduto;
¬† document.getElementById('sobra-qtd-consumir').value = qtdSugerida;
¬† document.getElementById('sobra-saldo-atual').textContent = "Buscando...";

¬† M.updateTextFields();

  // 2. Apenas abre o modal. A busca de dados foi movida.
¬† modalConsumirSobraInstance.open();
}

// <<< NOVA FUN√á√ÉO >>>
// Esta fun√ß√£o √© chamada automaticamente QUANDO o modal termina de abrir
function buscarSaldoDeSobra() {
    const codProduto = document.getElementById('sobra-cod-produto').textContent;

    if (!codProduto || codProduto === '---') {
        document.getElementById('sobra-saldo-atual').textContent = 'Erro: C√≥d. Produto n√£o encontrado.';
        return;
    }

    // 3. AGORA SIM, com o modal aberto, buscamos o saldo
    google.script.run
        .withSuccessHandler(infoSobra => {
            document.getElementById('sobra-saldo-atual').textContent =
                `${formatarNumero(infoSobra.qtd)} (Cliente: ${infoSobra.cliente})`;
        })
        .withFailureHandler(err => {
            document.getElementById('sobra-saldo-atual').textContent = `Erro: ${err.message}`;
        })
        ._buscarSobraEstoque(codProduto);
}

window.abrirModalConsumirSobra = abrirModalConsumirSobra;

// [SUBSTITUA A FUN√á√ÉO 'gerarBotoesAcao' (L666) INTEIRA]

function gerarBotoesAcao(pedido) {
    //debugPedido(pedido); // Descomente se precisar depurar
    const linha = pedido.linhaPlanilha;
    const codProd = pedido.codProduto;
    const qtdCores = pedido.qtdCores || 0;
    const status = pedido.status;
    const maquina = pedido.maquina;
    const facaModelo = pedido.faca || "";
    let htmlBotoes = '';

    const obsPCP = pedido.obsPCP || "";
    
    // <<< IN√çCIO DA CORRE√á√ÉO (L√≥gica movida para c√°) >>>
    
    // 1. Vari√°vel segura para o JAVASCRIPT
    const obsPCP_safe_js = obsPCP
        .replace(/\\/g, '\\\\') 
        .replace(/'/g, "\\'");  

    // 2. Vari√°vel segura para o HTML
    const obsPCP_safe_tooltip = obsPCP
        .replace(/"/g, '&quot;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
        
    // 3. VERIFICA SE √â UM PEDIDO DE SOBRA DE ESTOQUE
    // Esta √© a nova l√≥gica: se for sobra, s√≥ mostre este bot√£o.
    if (obsPCP.toUpperCase().includes("ESTOQUE DE SOBRA")) {
        
        htmlBotoes = `
        <button class="btn-floating waves-effect waves-light orange tooltipped" 
                data-tooltip="Consumir Sobra de Estoque (${obsPCP_safe_tooltip})" 
                data-action="CONSUMIR_SOBRA"
                data-num-pedido="${pedido.numPedido}"
                data-cod-produto="${codProd}"
                data-obs-pcp="${obsPCP_safe_js}">
            <i class="material-icons">inventory_2</i>
        </button>`;
        
        // Retorna imediatamente, ignorando os bot√µes de Setup/Play
        return htmlBotoes; 
    }
    // <<< FIM DA CORRE√á√ÉO >>>

    // ===================================
    // ROTEIRO C: FLEXO DIGITAL
    // ===================================
    // (Se n√£o for pedido de sobra, a l√≥gica normal continua)
    if (maquina === "Flexo Digital") {
        switch (status) {
            case "Programado":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light blue tooltipped" 
                            data-tooltip="Iniciar Setup (Digital)" 
                            data-action="INICIAR_SETUP_DIGITAL" data-linha="${linha}">
                        <i class="material-icons">settings</i>
                    </button>`;
                break;
            case "Setup (Digital)":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light green tooltipped" 
                            data-tooltip="Iniciar Impress√£o" 
                            data-action="INICIAR_IMPRESSAO_DIGITAL" data-linha="${linha}">
                        <i class="material-icons">print</i>
                    </button>`;
                break;
            case "Imprimindo (Digital)":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light cyan tooltipped" 
                            data-tooltip="Iniciar Corte" 
                            data-action="INICIAR_CORTE_DIGITAL" data-linha="${linha}">
                        <i class="material-icons">content_cut</i>
                    </button>`;
                break;
            case "Cortando (Digital)":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light blue tooltipped" 
                            data-tooltip="Registrar Consumo" 
                            data-action="ABRIR_MODAL_CONSUMO_PADRAO">
                        <i class="material-icons">straighten</i>
                    </button>`;
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light purple tooltipped" 
                            data-tooltip="Finalizar Produ√ß√£o (Enviar p/ CQ)" 
                            data-action="FINALIZAR_PRODUCAO_DIGITAL" data-linha="${linha}">
                        <i class="material-icons">check</i>
                    </button>`;
                break;
            case "Aguardando Corte (Digital)":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light cyan tooltipped" 
                            data-tooltip="Iniciar Corte" 
                            data-action="INICIAR_CORTE_DIGITAL" data-linha="${linha}">
                        <i class="material-icons">content_cut</i>
                    </button>`;
                break;
        }
    }
    // ===================================
    // ROTEIRO A/B: FLEXO CONVENCIONAL
    // ===================================
    else {
        switch (status) {
            case "Programado":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light blue tooltipped" 
                            data-tooltip="Iniciar Setup e Definir Anilox/Faca" 
                            data-action="INICIAR_SETUP_FLEXO" 
                            data-linha="${linha}" 
                            data-cod-produto="${codProd}" 
                            data-qtd-cores="${qtdCores}"
                            data-faca-modelo="${facaModelo}"> <i class="material-icons">settings</i>
                    </button>
                    `;
                break;
            case "Setup":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light green tooltipped" 
                            data-tooltip="Iniciar Produ√ß√£o" 
                            data-action="INICIAR_PRODUCAO_FLEXO" data-linha="${linha}">
                        <i class="material-icons">play_arrow</i>
                    </button>
                    `;
                break;
            case "Em produ√ß√£o":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light blue tooltipped" 
                            data-tooltip="Registrar Consumo/Refugo" 
                            data-action="ABRIR_MODAL_CONSUMO_PADRAO">
                        <i class="material-icons">straighten</i>
                    </button>
                    `;
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light purple tooltipped" 
                            data-tooltip="Finalizar Impress√£o (Enviar p/ CQ ou Batida)" 
                            data-action="FINALIZAR_PRODUCAO_FLEXO" data-linha="${linha}">
                        <i class="material-icons">check</i>
                    </button>
                    `;
                break;
            case "Controlando":
                htmlBotoes += `
                    <button class="btn-floating waves-effect waves-light blue tooltipped" 
                            data-tooltip="Registrar Consumo Adicional" 
                            data-action="ABRIR_MODAL_CONSUMO_PADRAO">
                        <i class="material-icons">straighten</i>
                    </button>
                    <button class="btn-floating waves-effect waves-light purple tooltipped" 
                            data-tooltip="Finalizar Produ√ß√£o" 
                            data-action="FINALIZAR_PRODUCAO_FLEXO" data-linha="${linha}">
                        <i class="material-icons">check</i>
                    </button>
                    `;
                break;
            case "Produ√ß√£o Finalizada":
            case "Aguardando Batida":
                htmlBotoes += `<span class="grey-text tooltipped" data-tooltip="Aguardando Pr√≥ximo Setor"><i class="material-icons">hourglass_bottom</i></span>`;
                break;
        }
    }

    return htmlBotoes;
}

    // ===============================================
    // INICIALIZA√á√ÉO
    // ===============================================
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializa Modais
        modalAtrasoInstance = M.Modal.init(document.getElementById('motivo-atraso-modal'), { dismissible: false });
        consumoModalInstance = M.Modal.init(document.getElementById('modalConsumo'), { dismissible: true });
        modalDetalhesInstance = M.Modal.init(document.getElementById('detalhes-pedido-modal'), { dismissible: true });
        modalMotivoConsumoInstance = M.Modal.init(document.getElementById('modalMotivoConsumo'), { dismissible: false });
        modalAniloxInstance = M.Modal.init(document.getElementById('modalAnilox'), { dismissible: false });
        modalConsumirSobraInstance = M.Modal.init(
    document.getElementById('modalConsumirSobra'),
    {
        dismissible: true,
        onOpenEnd: function() {
            // Esta fun√ß√£o ser√° chamada QUANDO o modal terminar de abrir
            buscarSaldoDeSobra();
        }
    }
);
        
        // <<< NOVO: Inicializa√ß√£o do modal de problema integrado >>>
        problemaModalInstance = M.Modal.init(document.getElementById('modalReportarProblema'), { dismissible: false });
        problemaNumPedidoInput = document.getElementById('problema_numPedido');
        problemaFerramentaSelect = document.getElementById('problema_ferramenta');
        problemaBtnConfirm = document.getElementById('btnConfirmarReporteProblema');

        // Listeners dos Modais
        document.getElementById('motivoAtrasoConfirmar').addEventListener('click', onConfirmarAtrasoClick);
        document.getElementById('motivoAtrasoInput').addEventListener('input', checkMotivoAtrasoInput);
        document.getElementById('motivoConsumoConfirmar').addEventListener('click', onConfirmarMetragemExcessiva);
        document.getElementById('motivoConsumoInput').addEventListener('input', checkMotivoConsumoInput);
        document.getElementById('btn-confirmar-consumo-sobra').addEventListener('click', handleConfirmarConsumoSobra);

        // <<< NOVOS LISTENERS PARA O MODAL DE PROBLEMA INTEGRADO >>>
        problemaNumPedidoInput.addEventListener('change', handlePedidoReporteChange);
        problemaFerramentaSelect.addEventListener('change', handleFerramentaReporteChange);
        document.getElementById('problema_descricao_cliche').addEventListener('input', checkReporteInputs);
        document.getElementById('problema_descricao_faca').addEventListener('input', checkReporteInputs);
        document.getElementById('problema_tipo_cliche').addEventListener('change', checkReporteInputs);
        document.getElementById('problema_tipo_faca').addEventListener('change', checkReporteInputs);
        // <<< FIM DOS NOVOS LISTENERS >>>
        
        // Carrega dados do servidor
        todosPedidos = dadosServidor.pedidos || [];
        listaMaquinas = dadosServidor.maquinas || [];
        listaFornecedores = dadosServidor.fornecedores || [];
        listaImpressores = dadosServidor.impressores || [];
        listaAnilox = dadosServidor.anilox || [];
        
        renderizarTelaCompleta();
        setupListeners();
    });

    // ===============================================
// FUN√á√ÉO HELPER: Executar com retry autom√°tico
// ===============================================
function executarComRetry(funcaoBackend, parametros, onSuccess, onError, tentativas = 3) {
    const executar = (tentativasRestantes) => {
        google.script.run
            .withSuccessHandler(onSuccess)
            .withFailureHandler((erro) => {
                console.warn(`Tentativa falhou. Restantes: ${tentativasRestantes - 1}`, erro);
                
                if (tentativasRestantes > 1) {
                    // Aguarda 1 segundo e tenta novamente
                    setTimeout(() => executar(tentativasRestantes - 1), 1000);
                } else {
                    onError(erro);
                }
            })
            [funcaoBackend](...parametros);
    };
    
    executar(tentativas);
}
    
// [SUBSTITUA ESTA FUN√á√ÉO EM FormProducao.html]

function setupListeners() {
    const tabelaCorpo = document.getElementById('tabela-programar-corpo');
    const quadrosContainer = document.getElementById('quadros-maquinas-container');
    const batidaContainer = document.getElementById('quadro-batida-container'); 
    
    // Listeners de MUDAN√áA (Input/Change) - Mantidos
    tabelaCorpo.addEventListener('change', handleEvento);
    quadrosContainer.addEventListener('change', handleEvento);
    tabelaCorpo.addEventListener('input', handleEvento); 
    quadrosContainer.addEventListener('input', handleEvento);

    // =============================================================
    // *** CORRE√á√ÉO: ADICIONANDO LISTENER DE CLIQUE NA TABELA DE CIMA ***
    // =============================================================
    tabelaCorpo.addEventListener('click', function(event) {
        event.stopPropagation();
        
        // Tenta encontrar um bot√£o com 'data-action'
        const btn = event.target.closest('button[data-action]');
        
        if (btn) {
            const acao = btn.dataset.action;

            if (acao === 'CONSUMIR_SOBRA') {
                const numPedido = btn.dataset.numPedido;
                const codProduto = btn.dataset.codProduto;
                const obsPCP = btn.dataset.obsPcp;
                
                // Chama a fun√ß√£o DIRETAMENTE (agora funciona)
                abrirModalConsumirSobra(numPedido, codProduto, obsPCP);
                return;
            }
            return;
        }

        // Se n√£o foi um bot√£o, verifica se foi um clique no link do N¬∞ Pedido
        const linkPedido = event.target.closest('.link-pedido');
        if (linkPedido) {
            const linha = linkPedido.closest('tr').dataset.linhaPlanilha;
            handleNumeroPedidoClick(linha);
            return;
        }
    });
    // =============================================================
    // *** FIM DA CORRE√á√ÉO ***
    // =============================================================

    // Listener de CLIQUE (Tabelas de Baixo) - Mantido
    quadrosContainer.addEventListener('click', function(event) {
        // Previne propaga√ß√£o para m√∫ltiplos bot√µes
        event.stopPropagation();
        
        const btn = event.target.closest('button');
        if (!btn) return;
        
        const acao = btn.dataset.action;
        const linha = btn.dataset.linha;
        
        // Se a a√ß√£o for de fila, executa e para
        if (acao === 'UP' || acao === 'DOWN') {
            reordenarPedidos(linha, acao);
            return;
        }

        // Tenta encontrar o pedido no cache 'todosPedidos'
        const pedido = todosPedidos.find(p => p.linhaPlanilha == linha);
        
        // Pega dados do bot√£o (para os casos de fallback)
        const codProduto = btn.dataset.codProduto;
        const qtdCores = btn.dataset.qtdCores;
        const facaModelo = btn.dataset.facaModelo;
        
        switch(acao) {

                    case 'ABRIR_MODAL_CONSUMO_PADRAO':
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† if (pedido) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† abrirModalConsumo(pedido.numPedido, pedido.impressor || '');
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† // Fallback se o pedido n√£o estiver no cache (raro)
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const tr = btn.closest('tr');
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const numPedido = tr.querySelector('.col-pedido-mq').textContent;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const impressor = tr.querySelector('.col-impressor-mq select').value;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† abrirModalConsumo(numPedido, impressor || '');
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† break;

            // <<< IN√çCIO DA CORRE√á√ÉO >>>
¬† ¬† ¬† ¬† ¬† ¬† case 'CONSUMIR_SOBRA':
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const numPedido = btn.dataset.numPedido;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const codProduto = btn.dataset.codProduto;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const obsPCP = btn.dataset.obsPcp;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† abrirModalConsumirSobra(numPedido, codProduto, obsPCP);
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† break;

            case 'INICIAR_SETUP_FLEXO':
                const p_codProd = pedido ? pedido.codProduto : codProduto;
                const p_qtdCores = pedido ? pedido.qtdCores : qtdCores;
                const p_facaModelo = pedido ? pedido.faca : facaModelo;
                abrirModalAnilox(linha, p_codProd, p_qtdCores, p_facaModelo);
                break;
                
            case 'INICIAR_PRODUCAO_FLEXO':
                iniciarProducao(btn, linha);
                break;
                
            case 'FINALIZAR_PRODUCAO_FLEXO':
                finalizarProducao(btn, linha);
                break;
                
            case 'INICIAR_SETUP_DIGITAL':
                iniciarSetupDigital(btn, linha);
                break;
                
            case 'INICIAR_IMPRESSAO_DIGITAL':
                iniciarImpressaoDigital(btn, linha);
                break;
                
            case 'INICIAR_CORTE_DIGITAL':
                iniciarCorteDigital(btn, linha);
                break;
                
            case 'FINALIZAR_PRODUCAO_DIGITAL':
                finalizarProducaoDigital(btn, linha);
                break;
        }
    });
    
    // Listener de CLIQUE (Batida) - Mantido
    batidaContainer.addEventListener('click', function(event) {
            const btn = event.target.closest('button');
            if (!btn) return;
            const acao = btn.dataset.action;
            const linha = btn.dataset.linha;
            if (acao === 'FINALIZAR_BATIDA') {
                finalizarBatida(btn, linha);
            }
    });
    
    document.getElementById('btnSalvar').addEventListener('click', onSalvarClick);
}

    function showErrorToast(error) {
  // Esta linha extrai a 'mensagem' se for um objeto, ou usa o pr√≥prio 'error' se for texto
  const msg = (typeof error === 'object' && error.message) ? error.message : error;
  M.toast({ html: '<i class="material-icons left">error</i> ' + msg, classes: 'red darken-2', displayLength: 5000 });
}

    
    // ===============================================
    // FUN√á√ïES DE RENDERIZA√á√ÉO (Cria√ß√£o do HTML)
    // ===============================================
    function renderizarTelaCompleta() {
        const tabelaCorpo = document.getElementById('tabela-programar-corpo');
        const quadrosContainer = document.getElementById('quadros-maquinas-container');
        const batidaCorpo = document.getElementById('tabela-batida-corpo'); 
        
        const msgSemPedidos = document.getElementById('msg-sem-pedidos');
        const msgSemMaquinas = document.getElementById('msg-sem-maquinas');
        const msgSemBatida = document.getElementById('msg-sem-batida'); 

        tabelaCorpo.innerHTML = '';
        quadrosContainer.innerHTML = '';
        batidaCorpo.innerHTML = ''; 

        let pedidosNaTabela = [];
        let pedidosEmQuadros = {}; 
        let pedidosNaBatida = []; 

        todosPedidos.forEach(pedido => {
            if (pedido.status === 'Liberado para produ√ß√£o' && !pedido.maquina) { 
                pedidosNaTabela.push(pedido);
            } 
            else if (pedido.status === 'Aguardando Batida') { 
                pedidosNaBatida.push(pedido);
            }
            // <<< MUDAN√áA (V4.5) >>>
            // Pedidos da Digital tamb√©m v√£o para as filas de m√°quinas
            else if (pedido.maquina) { 
                if (!pedidosEmQuadros[pedido.maquina]) {
                    pedidosEmQuadros[pedido.maquina] = [];
                }
                pedidosEmQuadros[pedido.maquina].push(pedido);
            }
        });

        // 1. Renderiza Tabela Superior (Para Programar)
        if (pedidosNaTabela.length === 0) {
            msgSemPedidos.style.display = 'block';
        } else {
            msgSemPedidos.style.display = 'none';
            pedidosNaTabela.sort((a, b) => parseDate(a.dataEntrega) - parseDate(b.dataEntrega));
            pedidosNaTabela.forEach(pedido => {
                tabelaCorpo.appendChild(criarLinhaTabela(pedido));
            });
        }

        // 2. Renderiza Quadros de M√°quina (Flexo e Digital)
        const maquinasComPedidos = Object.keys(pedidosEmQuadros);
        maquinasComPedidos.sort((a, b) => {
            const indexA = ORDEM_MAQUINAS.indexOf(a);
            const indexB = ORDEM_MAQUINAS.indexOf(b);
            if (indexA !== -1 && indexB !== -1) return indexA - indexB;
            if (indexA !== -1) return -1;
            if (indexB !== -1) return 1;
            return a.localeCompare(b);
        });
        if (maquinasComPedidos.length === 0) {
            msgSemMaquinas.style.display = 'block';
        } else {
            msgSemMaquinas.style.display = 'none';
            maquinasComPedidos.forEach(nomeMaquina => {
                const pedidosOrdenados = pedidosEmQuadros[nomeMaquina].sort((a, b) => (parseInt(a.fila) || 999) - (parseInt(b.fila) || 999));
                quadrosContainer.appendChild(criarQuadroMaquinaComTabela(nomeMaquina, pedidosOrdenados));
            });
        }
        
        // 3. Renderiza Tabela Inferior (Fila da Batida)
        if (pedidosNaBatida.length === 0) {
            msgSemBatida.style.display = 'block';
        } else {
            msgSemBatida.style.display = 'none';
            pedidosNaBatida.sort((a, b) => parseDate(a.dataEntrega) - parseDate(b.dataEntrega));
            pedidosNaBatida.forEach(pedido => {
                batidaCorpo.appendChild(renderizarLinhaBatida(pedido));
            });
        }

        // <<< CORRE√á√ÉO V4.6 >>>
        M.FormSelect.init(document.querySelectorAll('select'), materializeSelectOptions);
        M.Tooltip.init(document.querySelectorAll('.tooltipped'));
    }

    // [SUBSTITUA ESTA FUN√á√ÉO EM FormProducao.html]

// [SUBSTITUA ESTA FUN√á√ÉO EM FormProducao.html]

// [SUBSTITUA A FUN√á√ÉO 'criarLinhaTabela' (L1092) INTEIRA]

function criarLinhaTabela(pedido) {
    const tr = document.createElement('tr');
    tr.dataset.linhaPlanilha = pedido.linhaPlanilha;

    const dataStatus = checkDataStatus(pedido.dataEntrega);
    const obsPCP = pedido.obsPCP || '';
    
    // --- CORRE√á√ÉO ---
    // A l√≥gica de "ESTOQUE DE SOBRA" foi REMOVIDA daqui.
    // Esta fun√ß√£o agora SEMPRE renderiza os campos para programa√ß√£o.
    
    let opcoesMaquina = `<option value="" selected>Selecionar...</option>`;
    listaMaquinas.forEach(maq => {
        opcoesMaquina += `<option value="${maq}">${maq}</option>`;
    });
    
    // Renderiza o Dropdown de M√°quina (SEMPRE)
    const maquinaCellHtml = `
        <div class="input-field" data-tipo-change="maquina">
            <select class="maquina-select">
                ${opcoesMaquina}
            </select>
        </div>`;
    
    // Renderiza o Input de Observa√ß√£o (SEMPRE)
    const obsCellHtml = `
        <div class="input-field" data-tipo-change="obsPCP">
            <input type="text" value="${obsPCP}">
        </div>`;
    // --- FIM DA CORRE√á√ÉO ---

    // Monta o HTML da linha
    tr.innerHTML = `
        <td class="col-pedido link-pedido" title="Ver Detalhes">${pedido.numPedido}</td>
        <td class="col-data ${dataStatus.classe}">
            ${pedido.dataEntrega} ${dataStatus.icone}
        </td>
        <td class="col-cliente">${pedido.cliente}</td>
        <td class="col-descricao">${pedido.descricao}</td>
        <td class="col-status-atual ${getStatusColorClass(pedido.status)}">
            ${pedido.status}
        </td>
        <td class="col-maquina">
            ${maquinaCellHtml} 
        </td>
        <td class="col-obs">
            ${obsCellHtml}
        </td>
    `;
    
    return tr;
}

    function criarQuadroMaquinaComTabela(nomeMaquina, pedidos) {
        const divQuadro = document.createElement('div');
        divQuadro.className = 'maquina-quadro';
        divQuadro.innerHTML = `
            <h5 class="maquina-titulo">
                <i class="material-icons">precision_manufacturing</i>
                ${nomeMaquina}
            </h5>
            <div class="quadro-corpo"></div>
        `;
        
        const corpoQuadro = divQuadro.querySelector('.quadro-corpo');
        const tabela = document.createElement('table');
        tabela.className = 'maquina-tabela highlight';
        
        tabela.innerHTML = `
            <thead>
                <tr>
                    <th class="col-fila-mq">FILA</th>
                    <th class="col-pedido-mq">N¬∫ PEDIDO</th>
                    <th class="col-data-mq">DATA DE ENTREGA</th>
                    <th class="col-cliente-mq">CLIENTE</th>
                    <th class="col-descricao-mq">DESCRI√á√ÉO</th>
                    <th class="col-maquina-mq">M√ÅQUINA</th>
                    <th class="col-qtd-mq">QTD.</th>
                    <th class="col-metragem-mq">METRAGEM</th>
                    <th class="col-impressor-mq">IMPRESSOR</th>
                    <th class="col-status-mq">STATUS</th>
                    <th class="col-acoes-mq">A√á√ïES</th>
                </tr>
            </thead>
            <tbody></tbody>
        `;
        
        const tbody = tabela.querySelector('tbody');
        const totalPedidosNaMaquina = pedidos.length;

        pedidos.forEach((pedido, index) => {
            const tr = document.createElement('tr');
            tr.dataset.linhaPlanilha = pedido.linhaPlanilha;
            
            const isPrimeiro = index === 0;
            const isUltimo = index === totalPedidosNaMaquina - 1;
            const tdFilaContent = `
                <div class="fila-controles">
                    <button class="btn-fila" data-action="UP" data-linha="${pedido.linhaPlanilha}" ${isPrimeiro ? 'disabled' : ''}>‚ñ≤</button>
                    <span class="fila-numero">${index + 1}</span>
                    <button class="btn-fila" data-action="DOWN" data-linha="${pedido.linhaPlanilha}" ${isUltimo ? 'disabled' : ''}>‚ñº</button>
                </div>
            `;
            
            const dataStatus = checkDataStatus(pedido.dataEntrega);
            const qtdFormatada = formatarNumero(pedido.quantidade);
            const metragemFormatada = formatarNumero(pedido.metragem);
            
            tr.innerHTML = `
                <td class="col-fila-mq">${tdFilaContent}</td>
                <td class="col-pedido-mq link-pedido" onclick="handleNumeroPedidoClick('${pedido.linhaPlanilha}')" title="Ver Detalhes">${pedido.numPedido}</td>
                <td class="col-data-mq ${dataStatus.classe}">
                    ${pedido.dataEntrega} ${dataStatus.icone}
                </td>
                <td class="col-cliente-mq">${pedido.cliente}</td>
                <td class="col-descricao-mq">${pedido.descricao}</td>
                <td class="col-maquina-mq">
                    <div class="input-field" data-tipo-change="maquina">
                        <select>
                            <option value="" ${!pedido.maquina ? 'selected' : ''}>Desprogramar</option>
                            ${gerarOptions(listaMaquinas, pedido.maquina)}
                        </select>
                    </div>
                </td>
                <td class="col-qtd-mq">
                    <input type="text" value="${qtdFormatada}" readonly>
                </td>
                <td class="col-metragem-mq">
                    <input type="text" value="${metragemFormatada}" readonly>
                </td>
                <td class="col-impressor-mq">
                    <div class="input-field" data-tipo-change="impressor">
                        <select>
                            ${gerarOptions(listaImpressores, pedido.impressor, true)}
                        </select>
                    </div>
                </td>
                <td class="col-status-atual ${getStatusColorClass(pedido.status)}">
                    ${pedido.status}
                </td>
                <td class="col-acoes-mq">
                    ${gerarBotoesAcao(pedido)}
                </td>
            `;
            
            tbody.appendChild(tr);
        });

        corpoQuadro.appendChild(tabela);
        return divQuadro;
    }
    
    function renderizarLinhaBatida(pedido) {
        const tr = document.createElement('tr');
        tr.dataset.linhaPlanilha = pedido.linhaPlanilha;

        const dataStatus = checkDataStatus(pedido.dataEntrega);

        tr.innerHTML = `
            <td class="col-pedido-batida link-pedido" onclick="handleNumeroPedidoClick('${pedido.linhaPlanilha}')" title="Ver Detalhes">${pedido.numPedido}</td>
            <td class="col-data-batida ${dataStatus.classe}">
                ${pedido.dataEntrega} ${dataStatus.icone}
            </td>
            <td class="col-cliente-batida">${pedido.cliente}</td>
            <td class="col-descricao-batida">${pedido.descricao}</td>
            <td class="col-faca-batida">${pedido.faca}</td>
            <td class="col-status-atual ${getStatusColorClass(pedido.status)}">
                ${pedido.status}
            </td>
            <td class="col-acoes-mq">
                <button class="btn-floating waves-effect waves-light purple tooltipped" 
                        data-tooltip="Finalizar Acabamento (Enviar p/ CQ)" 
                        data-action="FINALIZAR_BATIDA" data-linha="${pedido.linhaPlanilha}">
                    <i class="material-icons">check</i>
                </button>
            </td>
        `;
        return tr;
    }

    function debugPedido(pedido) {
    console.log("=== ESTRUTURA DO PEDIDO ===");
    console.log("Propriedades dispon√≠veis:", Object.keys(pedido));
    console.log("Pedido completo:", pedido);
    console.log("===========================");
}




function preencherDropdownFacas(itens) {
    const select = document.getElementById('anilox_faca_item');
    const btnConfirm = document.getElementById('btnConfirmarSetup');
    
    if (!itens || itens.length === 0) {
        select.innerHTML = '<option value="" disabled selected>NENHUM ITEM "Dispon√≠vel" encontrado!</option>';
        showErrorToast("Aten√ß√£o: N√£o h√° nenhuma faca deste modelo dispon√≠vel no invent√°rio.");
        btnConfirm.disabled = true; // Bloqueia o in√≠cio do setup
    } else {
        let options = '<option value="" disabled selected>Selecione o item...</option>';
        itens.forEach(item => {
            options += `<option value="${item}">${item}</option>`;
        });
        select.innerHTML = options;
        btnConfirm.disabled = false; // Libera o bot√£o
    }
    
    // Re-inicializa o select do Materialize
    M.FormSelect.init(select, materializeSelectOptions);
}
    
    // ===============================================
    // FUN√á√ïES DE EVENTOS (HANDLERS)
    // ===============================================
    
    function handleEvento(event) {
        const elemento = event.target; 
        const container = elemento.closest('.input-field[data-tipo-change]');
        if (!container) return; 
        const tipoChange = container.dataset.tipoChange;
        const tr = container.closest('tr[data-linha-planilha]');
        if (!tr) { return; }
        const linhaPlanilha = tr.dataset.linhaPlanilha;
        
        let valor;
        const selectReal = container.querySelector('select');
        if (selectReal) { valor = selectReal.value; } 
        else { valor = elemento.value; }

        const pedido = todosPedidos.find(p => p.linhaPlanilha == linhaPlanilha);
        if (!pedido) return;

        // L√ìGICA DE SALVAMENTO INSTANT√ÇNEO DA M√ÅQUINA
        if (tipoChange === 'maquina') {
            pedido.maquina = valor;
            const novoStatus = (valor) ? 'Programado' : 'Liberado para produ√ß√£o';
            pedido.status = novoStatus;
            
            showSuccessToast("Programando m√°quina...");
            renderizarTelaCompleta(); 
            
            google.script.run
                .withSuccessHandler(function(resposta) {
                    showSuccessToast("M√°quina salva!");
                    pedido.status = resposta.novoStatus; 
                    pedido.fila = resposta.novaFila;
                    renderizarTelaCompleta(); 
                })
                .withFailureHandler(function(err) {
                    showErrorToast(err.message);
                    pedido.maquina = ""; 
                    pedido.status = "Liberado para produ√ß√£o"; 
                    renderizarTelaCompleta(); 
                })
                .salvarProgramacaoMaquina(linhaPlanilha, valor);
            return; 
        }
        
        // L√ìGICA DE MUDAN√áAS MANUAIS (IMPRESSOR, OBS)
        pedido[tipoChange] = valor;
        if (!mudancas[linhaPlanilha]) mudancas[linhaPlanilha] = {};
        mudancas[linhaPlanilha][tipoChange] = valor;
        document.getElementById('btnSalvar').disabled = false;
    }
    
    function reordenarPedidos(linhaPlanilha, direcao) {
        const pedidoAtual = todosPedidos.find(p => p.linhaPlanilha == linhaPlanilha);
        if (!pedidoAtual) return;
        const nomeMaquina = pedidoAtual.maquina;

        const pedidosNaMaquina = todosPedidos
            .filter(p => p.maquina === nomeMaquina)
            .sort((a, b) => (parseInt(a.fila) || 999) - (parseInt(b.fila) || 999));
        
        const indiceAtual = pedidosNaMaquina.findIndex(p => p.linhaPlanilha == linhaPlanilha);
        if (indiceAtual === -1) return;

        const indiceDestino = (direcao === 'UP') ? indiceAtual - 1 : indiceAtual + 1;
        if (indiceDestino < 0 || indiceDestino >= pedidosNaMaquina.length) return;

        const pedidoDestino = pedidosNaMaquina[indiceDestino];

        pedidosNaMaquina.forEach((p, index) => {
            let novaFila = index + 1;
            if(p.linhaPlanilha === pedidoAtual.linhaPlanilha) {
              novaFila = indiceDestino + 1;
            } else if (p.linhaPlanilha === pedidoDestino.linhaPlanilha) {
              novaFila = indiceAtual + 1;
            }

            if (String(p.fila) !== String(novaFila)) {
              p.fila = novaFila.toString();
              if (!mudancas[p.linhaPlanilha]) mudancas[p.linhaPlanilha] = {};
              mudancas[p.linhaPlanilha].fila = p.fila;
            }
        });

        document.getElementById('btnSalvar').disabled = false;
        renderizarTelaCompleta(); 
    }

// [FormProducao.html - Fun√ß√£o abrirModalAnilox (~ Linha 1148)]

function abrirModalAnilox(linha, codProduto, qtdCores, facaModelo) { 
    // O tipoPedido precisa ser extra√≠do do cache local
    const pedido = todosPedidos.find(p => p.linhaPlanilha == linha);

    if (!pedido) {
        showErrorToast("Erro: Pedido n√£o encontrado no cache local!");
        return;
    }
    
    // Vari√°veis de Setup (Globals)
    setupLinhaPlanilha = linha;
    setupCodProduto = codProduto;
    setupQtdCores = parseInt(qtdCores, 10) || 0;

    const tipoPedido = pedido.tipoPedido || "Primeira Fabrica√ß√£o"; // <-- Usa o tipoPedido do cache
    const impressor = pedido.impressor || "";

    if (!impressor) {
        showErrorToast("Erro: Selecione um Impressor na tabela antes de Iniciar o Setup.");
        return;
    }

    // Preenche dados est√°ticos no modal
    document.getElementById('anilox_numPedido').textContent = pedido.numPedido;
    document.getElementById('anilox_codProduto').textContent = codProduto;
    document.getElementById('anilox_impressor').textContent = impressor;
    document.getElementById('anilox_faca_modelo').textContent = facaModelo || "N/A";
    
    // Reseta estado do modal
    document.getElementById('anilox-unlock-btn').style.display = 'none';

    // --- FACA: Busca Itens de Faca dispon√≠veis ---
    const selectFaca = document.getElementById('anilox_faca_item');
    selectFaca.innerHTML = '<option value="" disabled selected>Buscando facas...</option>';
    M.FormSelect.init(selectFaca, materializeSelectOptions); 

    executarComRetry(
        'getItensDeFacaDisponiveis',
        [facaModelo], // <-- Par√¢metro facaModelo passado
        preencherDropdownFacas,
        (erro) => {
            showErrorToast("Erro ao buscar facas: " + erro.message);
            selectFaca.innerHTML = '<option value="" disabled selected>Erro ao carregar facas</option>';
            M.FormSelect.init(selectFaca, materializeSelectOptions);
        }
    );

    // --- FICHA T√âCNICA: Loading ---
    document.getElementById('anilox-estacoes-wrapper').innerHTML = `
        <div id="anilox-loading" style="text-align: center; padding: 20px;">
             <div class="preloader-wrapper active">...</div> <p>Buscando Ficha T√©cnica do Produto...</p>
        </div>`;

    modalAniloxInstance.open();

    // --- FICHA T√âCNICA: Backend Call ---
    executarComRetry(
        'getFichaTecnicaParaSetup',
        [codProduto, tipoPedido],
        preencherModalAnilox, // Novo callback simples
        onPreencherAniloxErro,
        3
    );
}

// NOVO HELPER: Mude o nome da fun√ß√£o que voc√™ usava para gerar as op√ß√µes de cor
// ELA DEVE RECEBER listaCoresLaminas para ser globalmente segura.
function gerarOptionsCores(valorSelecionado) {
    let html = '<option value="" selected>Selecione a Cor/L√¢mina</option>';
    // Usando a vari√°vel global que definimos no passo A
    listaCoresLaminas.forEach(item => { 
        const selected = (item === valorSelecionado) ? 'selected' : '';
        html += `<option value="${item}" ${selected}>${item}</option>`;
    });
    return html;
}

// [SUBSTITUA ESTA FUN√á√ÉO INTEIRA - aprox. Linha 1291]

function preencherModalAnilox(data) {
    const wrapper = document.getElementById('anilox-estacoes-wrapper');
    const btnConfirm = document.getElementById('btnConfirmarSetup');
    const btnUnlock = document.getElementById('anilox-unlock-btn');

    // Pr√©-requisito: Verifica se a mudan√ßa no C√≥digo.gs foi feita
    if (data.tipoPedido === undefined) {
        wrapper.innerHTML = `<p class="mensagem-vazia" style="color: red; font-weight: bold;">
                ERRO: Parece que as altera√ß√µes no C√≥digo.gs (backend) n√£o foram aplicadas.<br>
                A fun√ß√£o 'getFichaTecnicaParaSetup' n√£o est√° retornando 'tipoPedido'.
                </p>`;
        console.error("Backend 'getFichaTecnicaParaSetup' est√° desatualizado.", data);
        return;
    }
    
    let dadosSalvos = [];
    try {
        dadosSalvos = JSON.parse(data.fichaTecnicaCores || "[]");
    } catch(e) { console.error("Erro ao parsear ficha tecnica: ", e); }

    const tipoPedido = data.tipoPedido || "Primeira Fabrica√ß√£o";
    const isRepeticao = (tipoPedido === 'Repeti√ß√£o');

    // Mostra o bot√£o de destravar se for Repeti√ß√£o
    if (isRepeticao) {
        btnUnlock.style.display = 'block';
        btnConfirm.disabled = false; // Pode salvar mesmo se for repeti√ß√£o (para o caso de s√≥ mudar o item da faca)
    } else {
        btnUnlock.style.display = 'none';
        btnConfirm.disabled = false;
    }
    
    // <<< CORRE√á√ÉO 1: L√≥gica de Esta√ß√µes >>>
    // const numEstacoesComDados = setupQtdCores - 1; // <-- REMOVIDO
    const numEstacoesComDados = setupQtdCores; // <-- CORRIGIDO

    // if (isNaN(setupQtdCores) || setupQtdCores <= 1) { // <-- REMOVIDO
    if (isNaN(setupQtdCores) || setupQtdCores < 1) { // <-- CORRIGIDO
        wrapper.innerHTML = `<p class="mensagem-vazia">Este produto tem ${setupQtdCores} cor(es). Nenhum Anilox/L√¢mina √© necess√°rio.</p>`;
        return;
    }

    // Certifique-se de que a fun√ß√£o gerarOptions est√° definida globalmente
    const optionsAnilox = gerarOptions(listaAnilox, null, "Selecione (Opcional)");
    let html = '';

    // <<< CORRE√á√ÉO 2: Loop de CRIA√á√ÉO de HTML >>>
    // for (let i = 0; i < MAX_ESTACOES_A_MOSTRAR; i++) { // <-- REMOVIDO
    for (let i = 0; i < setupQtdCores; i++) { // <-- CORRIGIDO
        const estacaoNum = i + 1;
        
        const dados = dadosSalvos[i] || {};
        
        const corSalva = dados.cor || "";
        const pantoneSalvo = dados.pantone || "";
        const aniloxSalvo = dados.anilox || "";
        const isPantone = (corSalva.toLowerCase() === 'pantone');
        
        // Desabilita se for Repeti√ß√£o E for uma esta√ß√£o que j√° tem dados salvos
        const disabledState = (isRepeticao && estacaoNum <= numEstacoesComDados) ? 'disabled' : '';
        
        // Gera op√ß√µes de Cor/L√¢mina
        const optionsCores = gerarOptionsCores(corSalva);
        
        html += `
            <div class="row anilox-cor-row" data-estacao="${estacaoNum}">
                
                <div class="col s2"> <span class="anilox-label">Esta√ß√£o ${estacaoNum}:</span>
                </div>
                
                <div class="col s3"> <div class="input-field"> 
                    <select id="anilox_cor_${estacaoNum}" class="anilox-cor-select" ${disabledState}>
                        ${optionsCores}
                    </select>
                </div>
                </div>
                
                <div class="col s3"> 
                    <div class="input-field"> 
                        <input type="text" id="anilox_pantone_${estacaoNum}"
                            value="${pantoneSalvo}"
                            placeholder="Pantone"
                            style="display: ${isPantone ? 'block' : 'none'};"
                            ${disabledState}>
                    </div>
                </div>
                
                <div class="col s4"> 
                    <div class="input-field"> 
                        <select id="anilox_setup_${estacaoNum}" ${disabledState}>
                            ${optionsAnilox}
                        </select>
                    </div>
                </div>
            </div>
        `;
    }
    
    wrapper.innerHTML = html;

    // <<< CORRE√á√ÉO 3: Loop de PREENCHIMENTO de valores >>>
    // (Este era o loop que estava quebrando seu script)
    // for (let i = 0; i < MAX_ESTACOES_A_MOSTRAR; i++) { // <-- REMOVIDO
    for (let i = 0; i < setupQtdCores; i++) { // <-- CORRIGIDO
        const estacaoNum = i + 1;
        const dados = dadosSalvos[i] || {}; 
        if (dados.anilox) {
            document.getElementById(`anilox_setup_${estacaoNum}`).value = dados.anilox;
        }
    }
    
    // Inicializa todos os selects
    // Esta linha agora ser√° executada, pois o loop acima n√£o quebra mais.
    M.FormSelect.init(wrapper.querySelectorAll('select'), materializeSelectOptions);

    // --- Adiciona Listeners ---

    // 1. Listener para mostrar/esconder Pantone
    wrapper.querySelectorAll('.anilox-cor-row').forEach(row => {
        const select = row.querySelector('.anilox-cor-select');
        select.addEventListener('change', function(e) {
            const estacao = row.dataset.estacao;
            const pantoneInput = document.getElementById(`anilox_pantone_${estacao}`);
            if (e.target.value.toLowerCase() === 'pantone') {
                pantoneInput.style.display = 'block';
            } else {
                pantoneInput.style.display = 'none';
                pantoneInput.value = ''; // Limpa se n√£o for pantone
            }
        });
        
        // Inicializa estado do pantone para itens pr√©-preenchidos
        const estacao = row.dataset.estacao;
        const pantoneInput = document.getElementById(`anilox_pantone_${estacao}`);
        if (select.value.toLowerCase() === 'pantone') {
            pantoneInput.style.display = 'block';
        } else {
            pantoneInput.style.display = 'none';
        }
    });

    // 2. Listener para o bot√£o de destravar
    btnUnlock.onclick = function() {     
        // Habilita todos os campos
        wrapper.querySelectorAll('select, input').forEach(el => {
            el.disabled = false;
        });
        
        // Re-inicializa os selects para refletir a mudan√ßa de 'disabled'
        M.FormSelect.init(wrapper.querySelectorAll('select'), materializeSelectOptions);
        
        // Esconde o pr√≥prio bot√£o
        btnUnlock.style.display = 'none';
    };
}

// [SUBSTITUA ESTA FUN√á√ÉO INTEIRA - aprox. Linha 1458]

function onSalvarAnilox() {
    const btn = document.getElementById('btnConfirmarSetup');
    btn.disabled = true;
    showSuccessToast("Salvando Anilox e iniciando setup...");

    const impressor = document.getElementById('anilox_impressor').textContent;

    // 1. Pega o ID da Faca (Valida√ß√£o obrigat√≥ria)
    const idUnicoFaca = document.getElementById('anilox_faca_item').value;
    if (!idUnicoFaca || idUnicoFaca.trim() === "") {
        showErrorToast("Erro: Voc√™ precisa selecionar o Item da Faca que ser√° utilizado.");
        btn.disabled = false;
        return;
    }

    // 3. Monta o JSON da Ficha T√©cnica
    let fichaTecnicaAtualizada = [];

    // <<< CORRE√á√ÉO 4: Loop de LEITURA para salvar >>>
    // const MAX_ESTACOES_A_SALVAR = 8; // <-- REMOVIDO
    // for (let i = 0; i < MAX_ESTACOES_A_SALVAR; i++) { // <-- REMOVIDO
    for (let i = 0; i < setupQtdCores; i++) { // <-- CORRIGIDO
        const estacaoNum = i + 1;

        const corSelect = document.getElementById(`anilox_cor_${estacaoNum}`);
        const pantoneInput = document.getElementById(`anilox_pantone_${estacaoNum}`);
        const aniloxSelect = document.getElementById(`anilox_setup_${estacaoNum}`);

        const cor = corSelect ? corSelect.value : "";
        // Salva Pantone somente se a cor for "Pantone"
        const pantone = (pantoneInput && cor.toLowerCase() === 'pantone') ? pantoneInput.value : "";
        const anilox = aniloxSelect ? aniloxSelect.value : "";

        // Adiciona a esta√ß√£o (preenchida ou vazia)
        fichaTecnicaAtualizada.push({
            estacao: estacaoNum,
            cor: cor || "",
            pantone: pantone || "",
            anilox: anilox || ""
        });
    }

    // Limpa: remove esta√ß√µes vazias (cor, pantone e anilox vazios) do final do array
    while (fichaTecnicaAtualizada.length > 0) {
        const last = fichaTecnicaAtualizada[fichaTecnicaAtualizada.length - 1];
        if (!last.cor && !last.pantone && !last.anilox) {
            fichaTecnicaAtualizada.pop();
        } else {
            break; // Para no primeiro item preenchido
        }
    }

    const jsonParaSalvar = JSON.stringify(fichaTecnicaAtualizada);

    // 4. Envia para o Backend
    google.script.run
        .withSuccessHandler(onAcaoWorkflowSucesso) 
        .withFailureHandler((err) => {
            onSalvarErro(err); 
            btn.disabled = false;
        })
        .iniciarSetupFlexo(
            setupLinhaPlanilha, 
            jsonParaSalvar, 
            setupCodProduto, 
            impressor,
            idUnicoFaca,
        );
}

    function iniciarProducao(botao, linhaPlanilha) {
        botao.disabled = true;
        const icone = botao.querySelector('i');
        icone.innerText = 'hourglass_top';
        showSuccessToast("Iniciando produ√ß√£o..."); 
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .iniciarProducaoPedido(linhaPlanilha); // Fun√ß√£o Flexo existente
    }

    function finalizarProducao(botao, linhaPlanilha) {
        const pedido = todosPedidos.find(p => p.linhaPlanilha == linhaPlanilha);
        if (!pedido) {
            showErrorToast("Erro: Pedido n√£o encontrado no cache.");
            return;
        }
        const dataStatus = checkDataStatus(pedido.dataEntrega);
        if (dataStatus.classe === 'data-atrasada') {
            abrirModalAtraso(linhaPlanilha, "FLEXO"); // Passa o tipo
            return;
        }
        executarFinalizacao(linhaPlanilha, ''); 
    }

    function executarFinalizacao(linhaPlanilha, motivoAtraso) {
        const botao = document.querySelector(`tr[data-linha-planilha="${linhaPlanilha}"] button[data-action="FINALIZAR_PRODUCAO_FLEXO"]`);
        if (botao) {
            botao.disabled = true;
            botao.querySelector('i').innerText = 'hourglass_top';
            showSuccessToast("Finalizando produ√ß√£o flexo...");
        }
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .finalizarProducaoPedido(linhaPlanilha, motivoAtraso); // Fun√ß√£o Flexo existente
    }
    
    // --- ROTEIRO DA BATIDA ---
    function finalizarBatida(botao, linhaPlanilha) {
        botao.disabled = true;
        const icone = botao.querySelector('i');
        icone.innerText = 'hourglass_top';
        showSuccessToast("Finalizando acabamento..."); 
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .finalizarCorteBatida(linhaPlanilha);
    }

    // --- ROTEIRO FLEXO DIGITAL (NOVO V4.5) ---
    function iniciarSetupDigital(botao, linhaPlanilha) {
        const tr = botao.closest('tr');
        const selectImpressor = tr.querySelector('.input-field[data-tipo-change="impressor"] select');
        const impressor = (selectImpressor && selectImpressor.value) ? selectImpressor.value : "";
        
        if (!impressor) {
            showErrorToast("Erro: Selecione um Impressor na tabela antes de Iniciar o Setup.");
            return;
        }
        
        botao.disabled = true;
        botao.querySelector('i').innerText = 'hourglass_top';
        showSuccessToast("Iniciando Setup Digital...");
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .iniciarSetupDigital(linhaPlanilha, impressor);
    }
    
    function iniciarImpressaoDigital(botao, linhaPlanilha) {
        botao.disabled = true;
        botao.querySelector('i').innerText = 'hourglass_top';
        showSuccessToast("Iniciando Impress√£o Digital...");
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .iniciarImpressaoDigital(linhaPlanilha);
    }
    
    function iniciarCorteDigital(botao, linhaPlanilha) {
        botao.disabled = true;
        botao.querySelector('i').innerText = 'hourglass_top';
        showSuccessToast("Iniciando Corte Digital...");
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .iniciarCorteDigital(linhaPlanilha);
    }

    function finalizarProducaoDigital(botao, linhaPlanilha) {
           const pedido = todosPedidos.find(p => p.linhaPlanilha == linhaPlanilha);
        if (!pedido) {
            showErrorToast("Erro: Pedido n√£o encontrado no cache.");
            return;
        }
        const dataStatus = checkDataStatus(pedido.dataEntrega);
        if (dataStatus.classe === 'data-atrasada') {
            abrirModalAtraso(linhaPlanilha, "DIGITAL"); // Passa o tipo
            return;
        }
        executarFinalizacaoDigital(linhaPlanilha, '');
    }
    
    function executarFinalizacaoDigital(linhaPlanilha, motivoAtraso) {
        const botao = document.querySelector(`tr[data-linha-planilha="${linhaPlanilha}"] button[data-action="FINALIZAR_PRODUCAO_DIGITAL"]`);
        if (botao) {
            botao.disabled = true;
            botao.querySelector('i').innerText = 'hourglass_top';
            showSuccessToast("Finalizando produ√ß√£o digital...");
        }
        
        google.script.run
            .withSuccessHandler(onAcaoWorkflowSucesso)
            .withFailureHandler(onSalvarErro)
            .finalizarProducaoDigital(linhaPlanilha, motivoAtraso);
    }

    // Sucesso gen√©rico para Setup, Iniciar, Finalizar
    function onAcaoWorkflowSucesso(msg) {
        showSuccessToast(msg);
        mudancas = {};
        document.getElementById('btnSalvar').disabled = true;
        if (modalAniloxInstance) modalAniloxInstance.close();
        refreshPedidos();
    }
    
    // ===============================================
    // FUN√á√ïES DE SALVAR / REFRESH
    // ===============================================
    function onSalvarClick() {
        const btn = document.getElementById('btnSalvar');
        btn.disabled = true;
        showSuccessToast("Verificando altera√ß√µes...");

        const pedidosComMudancas = [];
        Object.keys(mudancas).forEach(linhaPlanilha => {
            const pedido = todosPedidos.find(p => p.linhaPlanilha == linhaPlanilha);
            if (pedido) {
                pedidosComMudancas.push(pedido); 
            }
        });

        if (pedidosComMudancas.length === 0) {
            showErrorToast("Nenhuma mudan√ßa detectada.");
            btn.disabled = true;
            return;
        }
        salvarPedidos(pedidosComMudancas);
    }
    
    function salvarPedidos(pedidos) {
        showSuccessToast("Salvando dados..."); 
        google.script.run
            .withSuccessHandler(onSalvarSucesso)
            .withFailureHandler(onSalvarErro)
            .salvarMudancasProducao(pedidos);
    }
    
    function onSalvarSucesso(msg) {
        showSuccessToast(msg);
        mudancas = {};
        document.getElementById('btnSalvar').disabled = true;
        refreshPedidos();
    }

    function showSuccessToast(msg) {
¬† ¬† M.toast({
¬† ¬† ¬† ¬† html: '<i class="material-icons left">check_circle</i> ' + msg,
¬† ¬† ¬† ¬† classes: 'green darken-1',
¬† ¬† ¬† ¬† displayLength: 3000
¬† ¬† });
}


function onSalvarErro(err) {
    showErrorToast(err.message || err);
    
    // Re-renderiza a tela para destravar quaisquer bot√µes
    // que ficaram em modo "loading" (hourglass_top)
    renderizarTelaCompleta(); 
    
    // Re-habilita bot√µes de salvar/confirmar
    document.getElementById('btnSalvar').disabled = false;
    document.getElementById('btnConfirmarSetup').disabled = false; 
    document.getElementById('btnConfirmarConsumo').disabled = false;
    restaurarBotaoReporte(); // Fun√ß√£o que voc√™ j√° possui
}

function onPreencherAniloxErro(err) {
    const wrapper = document.getElementById('anilox-estacoes-wrapper');
    const mensagemErro = err.message || err.toString();
    
    wrapper.innerHTML = `
        <div style="padding: 20px; text-align: center;">
            <i class="material-icons" style="font-size: 48px; color: #f44336;">error</i>
            <h5 style="color: #f44336;">Erro ao Buscar Ficha T√©cnica</h5>
            <div style="background: #ffebee; padding: 15px; border-radius: 4px; margin: 20px 0; text-align: left;">
                <strong>Detalhes:</strong><br>
                <code style="font-size: 0.9em; color: #c62828;">${mensagemErro}</code>
            </div>
            <p><strong>Poss√≠veis causas:</strong></p>
            <ul style="text-align: left; max-width: 400px; margin: 15px auto;">
                <li>Produto <strong>${setupCodProduto}</strong> n√£o existe na aba "Produtos"</li>
                <li>Coluna "FichaTecnicaCores" n√£o encontrada</li>
                <li>Problemas de conex√£o ou timeout</li>
                <li>Sess√£o expirada (recarregue a p√°gina)</li>
            </ul>
            <div style="margin-top: 20px;">
                <button class="btn red" onclick="modalAniloxInstance.close()">
                    <i class="material-icons left">close</i>Fechar
                </button>
                <button class="btn orange" onclick="location.reload()">
                    <i class="material-icons left">refresh</i>Recarregar P√°gina
                </button>
            </div>
        </div>`;
    
    document.getElementById('btnConfirmarSetup').disabled = true;
    showErrorToast("Erro: " + mensagemErro);
}

    function refreshPedidos() {
        showSuccessToast("Atualizando painel...");
        google.script.run
            .withSuccessHandler(function(novosPedidos) {
                todosPedidos = novosPedidos;
                renderizarTelaCompleta();
            })
            .withFailureHandler(onSalvarErro)
            .buscarPedidosParaProducao();
    }
    
    // ===============================================
    // FLUXO DE REGISTRO DE CONSUMO E REFUGO
    // ===============================================
    function abrirModalConsumo(numPedido, impressor) {
        document.getElementById('consumo_metragem_total').value = "";
        dadosConsumoPendentes = null; 
        const impressorDisplay = impressor || 'N/A';
        document.getElementById('consumo_numPedido').textContent = numPedido;
        document.getElementById('consumo_impressor').textContent = impressorDisplay;
        
        if (impressorDisplay === 'N/A' || impressorDisplay.trim() === '') {
            document.getElementById('btnConfirmarConsumo').disabled = true;
            showErrorToast('Por favor, selecione o Impressor na tabela da Fila antes de registrar o consumo.');
        } else {
            document.getElementById('btnConfirmarConsumo').disabled = false;
        }
        
        M.updateTextFields(); 
        const labelMetragem = document.querySelector('label[for="consumo_metragem_total"]');
        if (labelMetragem) { labelMetragem.classList.add('active'); }
        
        if (consumoModalInstance) consumoModalInstance.open();
        document.getElementById('consumo_metragem_total').focus(); 
    }

    function registrarConsumo() {
        const dados = {
            pedidoConsumido: document.getElementById('consumo_numPedido').textContent,
            metragemConsumida: document.getElementById('consumo_metragem_total').value,
            impressor: document.getElementById('consumo_impressor').textContent
        };
        const metragemLimpa = dados.metragemConsumida.replace(",", ".");
        const metragemNum = parseFloat(metragemLimpa) || 0;

        if (dados.impressor === 'N/A' || dados.impressor.trim() === '') {
            showErrorToast('O nome do Impressor √© obrigat√≥rio.'); return;
        }
        if (metragemNum <= 0) {
            showErrorToast('A metragem consumida deve ser um n√∫mero positivo.'); return;
        }
        
        document.getElementById('btnConfirmarConsumo').disabled = true;
        showSuccessToast("Verificando limites de metragem...");
        
        google.script.run
            .withSuccessHandler(onValidacaoConsumoSuccess)
            .withFailureHandler(onSalvarErro)
            .validarConsumoMetragem(dados); 
    }

    function onValidacaoConsumoSuccess(resposta) {
        document.getElementById('btnConfirmarConsumo').disabled = false;
        
        if (resposta.necessitaJustificativa) {
            dadosConsumoPendentes = resposta.dadosConsumo; 
            document.getElementById('motivo_numPedido').textContent = resposta.dadosConsumo.pedidoConsumido;
            document.getElementById('motivo_metragem_consumida').textContent = formatarNumero(resposta.dadosConsumo.metragemConsumida);
            document.getElementById('motivoConsumoInput').value = "";
            checkMotivoConsumoInput();
            
            consumoModalInstance.close();
            modalMotivoConsumoInstance.open();
            
            showErrorToast("Motivo de consumo excessivo √© obrigat√≥rio.");
            return;
        }
        
        if (resposta.sucesso) {
            showSuccessToast("Consumo validado. Registrando estoque...");
            registrarConsumoFinal(resposta.dadosConsumo);
        } else {
            onSalvarErro({ message: resposta.mensagem });
        }
    }

    function checkMotivoConsumoInput() {
        const input = document.getElementById('motivoConsumoInput');
        const btn = document.getElementById('motivoConsumoConfirmar');
        btn.disabled = input.value.trim().length < 10;
    }

    function onConfirmarMetragemExcessiva() {
        const motivo = document.getElementById('motivoConsumoInput').value.trim();
        if (motivo.length < 10) {
            showErrorToast("O motivo deve ter pelo menos 10 caracteres.");
            return;
        }
        
        dadosConsumoPendentes.motivoMetragemExcessiva = motivo;
        modalMotivoConsumoInstance.close();
        registrarConsumoFinal(dadosConsumoPendentes);
    }

    function registrarConsumoFinal(dados) {
        showSuccessToast("Registrando consumo...");
        google.script.run
            .withSuccessHandler(onConsumoSuccess)
            .withFailureHandler(onSalvarErro)
            .registrarConsumoPorPedido(dados);
    }

    function onConsumoSuccess(resposta) {
        if (resposta.sucesso) {
            showSuccessToast(resposta.mensagem);
            consumoModalInstance.close();
            refreshPedidos();
        } else {
            onSalvarErro({ message: resposta.mensagem });
        }
        document.getElementById('btnConfirmarConsumo').disabled = false;
    }
    
    function abrirModalAtraso(linhaPlanilha, tipoFluxo) {
        document.getElementById('motivoAtrasoInput').value = '';
        document.getElementById('motivoAtrasoConfirmar').disabled = true;

        // Sobrescreve o clique do bot√£o de confirma√ß√£o
        document.getElementById('motivoAtrasoConfirmar').onclick = function() {
            const motivo = document.getElementById('motivoAtrasoInput').value.trim();
            if (!motivo || motivo.length < 5) {
                showErrorToast("O motivo do atraso √© obrigat√≥rio (m√≠n. 5 caracteres).");
                return;
            }
            modalAtrasoInstance.close();
            
            // Chama a fun√ß√£o de finaliza√ß√£o correta
            if (tipoFluxo === "DIGITAL") {
              executarFinalizacaoDigital(linhaPlanilha, motivo);
            } else {
              executarFinalizacao(linhaPlanilha, motivo); // Padr√£o √© Flexo
            }
        };
        
        modalAtrasoInstance.open();
    }
    
    function checkMotivoAtrasoInput() {
        const input = document.getElementById('motivoAtrasoInput');
        const btn = document.getElementById('motivoAtrasoConfirmar');
        btn.disabled = input.value.trim().length === 0;
    }
    function onConfirmarAtrasoClick() { /* Sobrescrito pela l√≥gica de abertura */ }
    
    function handleNumeroPedidoClick(linhaPlanilha) {
        const loading = document.getElementById('detalhes-loading');
        const content = document.getElementById('detalhes-conteudo');
        const grid = content.querySelector('.detalhes-pedido-grid-3-col');
        
        loading.style.display = 'block';
        content.style.display = 'none';
        grid.innerHTML = ''; 
        content.querySelectorAll('.detalhes-pedido-secao').forEach(el => el.remove());
        
        modalDetalhesInstance.open();
        
        google.script.run
            .withSuccessHandler(onGetDetalhesSucesso)
            .withFailureHandler(onGetDetalhesErro)
            .getDetalhesCompletosDoPedido(linhaPlanilha); 
    }

    function onGetDetalhesSucesso(detalhes) {
        const loading = document.getElementById('detalhes-loading');
        const content = document.getElementById('detalhes-conteudo');
        const grid = content.querySelector('.detalhes-pedido-grid-3-col');
        grid.innerHTML = '';
        content.querySelectorAll('.detalhes-pedido-secao').forEach(el => el.remove());

        const addItem = (label, valor, span = 1, sufixo = '') => {
            const val = (valor || '---') + (valor ? sufixo : '');
            const item = document.createElement('div');
            item.className = `detalhes-pedido-item ${span === 2 ? 'span-2' : ''} ${span === 3 ? 'full-width' : ''}`;
            item.innerHTML = `<span class="detalhes-pedido-label">${label}</span><span class="detalhes-pedido-valor">${val}</span>`;
            grid.appendChild(item);
        };
        const addObs = (titulo, icone, valor, textoVazio) => {
            const secao = document.createElement('div');
            secao.className = 'detalhes-pedido-secao';
            let obsHtml = '';
            if (valor && valor.trim()) {
                let style = 'border-color: #ffc107; background-color: #fff3cd; color: #856404;'; // Amarelo
                if (titulo.includes('Problema') || titulo.includes('Cancelamento') || titulo.includes('Atraso')) {
                    style = 'border-color: #D32F2F; background-color: #FFEBEE; color: #B71C1C;'; // Vermelho
                }
                obsHtml = `<div class="detalhes-pedido-obs" style="${style}">${valor}</div>`;
            } else {
                obsHtml = `<div class="detalhes-pedido-obs vazio">${textoVazio}</div>`;
            }
            secao.innerHTML = `
                <h6 class="detalhes-pedido-secao-titulo"><i class="material-icons">${icone}</i> ${titulo}</h6>
                ${obsHtml}
            `;
            content.appendChild(secao);
        };

        // Preenche o Grid
        addItem('N¬∞ do Pedido', detalhes.numPedido);
        addItem('Data do Pedido', detalhes.dataPedido);
        addItem('Tipo de Pedido', detalhes.tipo);
        addItem('Quantidade Pedida', formatarNumero(detalhes.quantidade));
        addItem('Vendedora', detalhes.vendedora);
        addItem('Tipo de Expedi√ß√£o', detalhes.tipoExpedicao);
        addItem('Data de Entrega', detalhes.dataEntrega);
        addItem('Data de Conclus√£o', detalhes.dataConclusao);
        addItem('Status do Pedido', detalhes.status);
        addItem('C√≥d. Produto', detalhes.codProduto);
        addItem('Cliente', detalhes.cliente);
        addItem('C√≥d. Clich√™', detalhes.idCliche)
        addItem('Descri√ß√£o do Produto', detalhes.descricao, 2);
        addItem('Faca', detalhes.faca);
        addItem('Substrato', detalhes.substrato);
        addItem('Tipo de Cola', detalhes.tipoCola);
        addItem('Largura', detalhes.largura, 1, ' mm');
        addItem('Altura', detalhes.altura, 1, ' mm');
        addItem('Puxada', detalhes.puxada, 1, ' mm');
        addItem('Qtd. Cores', detalhes.qtdCores);
        addItem('Carreiras', detalhes.carreiras);
        addItem('Acabamento', detalhes.tipoAcabamento);
        addItem('Cold', detalhes.cold);
        addItem('Metragem Calculada', detalhes.metragem, 1, ' m');
        addItem('Sem Excedente?', (detalhes.semExcedente === 'true' || detalhes.semExcedente === 'VERDADEIRO') ? 'SIM' : 'N√ÉO');
        addItem('M√°quina (Prod)', detalhes.maquina);
        addItem('Fila (Prod)', detalhes.fila);
        addItem('Impressor', detalhes.impressor);
        addItem('Data In√≠cio Produ√ß√£o', detalhes.dataInicioProd);
        addItem('Data Fim Produ√ß√£o', detalhes.dataFimProd);
        addItem('Fornecedor Substrato', detalhes.fornecedorSubstrato);
        addItem('Lote Substrato', detalhes.loteSubstrato);
        addItem('Metragem Real', detalhes.metragemReal, 1, ' m');
        addItem('Refugo', detalhes.refugoMetragem, 1, ' m');
        addItem('Unidade CQ', detalhes.unidadeCQ);
        addItem('Inspetor', detalhes.inspetor);
        addItem('Qtd. Aprovada CQ', formatarNumero(detalhes.qtdAprovadaCQ));

        // Preenche Observa√ß√µes
        addObs('Observa√ß√µes PCP', 'announcement', detalhes.obsPCP, 'Nenhuma observa√ß√£o.');
        addObs('Problemas da Produ√ß√£o', 'build', detalhes.problemasProducao, 'Nenhum problema relatado.');
        addObs('Observa√ß√µes/Problemas CQ', 'info', detalhes.obsCQ, 'Nenhuma observa√ß√£o.');
        addObs('Motivo Metragem a Mais', 'warning', detalhes.motivoMaisMetragem, 'Nenhum motivo informado.');
        addObs('Motivo Atraso', 'history', detalhes.motivoAtraso, 'Nenhum atraso ou motivo informado.');
        addObs('Motivo Cancelamento', 'cancel', detalhes.motivoCancelamento, 'N√£o cancelado.');

        loading.style.display = 'none';
        content.style.display = 'block';
    }

    function onGetDetalhesErro(err) {
      showErrorToast('Erro ao buscar detalhes: ' + err.message);
      modalDetalhesInstance.close();
    }
    
    // ===============================================
    // FUN√á√ïES AUXILIARES GERAIS
    // ===============================================
    function formatarNumero(valor) {
      if (valor === null || valor === undefined || valor === "") return '0';
      let numeroLimpo = String(valor).replace(/\./g, '').replace(',', '.');
      let num = parseFloat(numeroLimpo);
      if (isNaN(num)) return valor;
      return num.toLocaleString('pt-BR', { maximumFractionDigits: 0, minimumFractionDigits: 0 });
    }

    function gerarOptions(lista, valorSelecionado, comVazio = false) {
      let html = comVazio ? `<option value="" ${!valorSelecionado ? 'selected' : ''}>${comVazio === true ? 'Selecione' : comVazio}</option>` : '';
      lista.forEach(item => {
          const selected = item === valorSelecionado ? 'selected' : '';
          html += `<option value="${item}" ${selected}>${item}</option>`;
      });
      return html;
    }
    
    function parseDate(dateString) {
      if (!dateString || typeof dateString !== 'string') return new Date(0); 
      const parts = dateString.split('/');
      if (parts.length !== 3) return new Date(0);
      return new Date(parts[2], parts[1] - 1, parts[0]); 
    }
    
    function checkDataStatus(dateString) {
      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);
      const dataEntrega = parseDate(dateString);
      if (dataEntrega.getTime() === 0) return { classe: '', icone: '' }; 
      const diffTime = dataEntrega.getTime() - hoje.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      if (diffDays < 0) return { classe: 'data-atrasada', icone: '<i class="material-icons data-status-icon">error_outline</i>' };
      if (diffDays <= 2) return { classe: 'data-alerta', icone: '<i class="material-icons data-status-icon">warning</i>' };
      return { classe: '', icone: '' };
    }

    function getStatusColorClass(status) {
      const statusNorm = (status || "").toLowerCase().replace(/ /g, '-').replace('(', '').replace(')', '');
      switch (statusNorm) {
          case "liberado-para-produ√ß√£o": return "status-liberado-prod";
          case "programado": return "status-programado";
          case "setup": return "status-setup";
          case "em-produ√ß√£o": return "status-em-producao";
          case "controlando": return "status-controlando";
          case "produ√ß√£o-finalizada": return "status-programado"; 
          case "aguardando-batida": return "status-aguardando-batida";
          case "na-expedi√ß√£o": return "status-na-expedicao";
          case "conclu√≠do": return "status-concluido";
          // Novos status digital
          case "setup-digital": return "status-setup-digital";
          case "imprimindo-digital": return "status-imprimindo-digital";
          case "cortando-digital": return "status-cortando-digital";
          case "aguardando-corte-digital": return "status-aguardando-corte-digital";
          default: return "";
      }
    }


function _showLoadingReporte(show) {
    const loading = document.getElementById('problema_loading');
    // A primeira DIV.row √© a do N¬∞ Pedido e Sele√ß√£o de Insumo
    const content = document.querySelector('#modalReportarProblema .row:first-of-type');    
    
    // Blocos condicionais
    const blocoCliche = document.getElementById('bloco_cliche');
    const blocoFaca = document.getElementById('bloco_faca');

    if (show) {
        loading.style.display = 'block';
        // Apenas oculta os blocos condicionais, mantendo o N¬∫ Pedido vis√≠vel
        blocoCliche.style.display = 'none';
        blocoFaca.style.display = 'none';
        
        // Mant√©m apenas o Confirmar Problema desabilitado
        problemaBtnConfirm.disabled = true;
    } else {
        loading.style.display = 'none';
        
        // O bot√£o Confirmar √© habilitado se a valida√ß√£o passar (checkReporteInputs)
        // O Reiniciar (btnReiniciarReporte) nunca √© desabilitado, garantindo o escape.
    }
    // Garante que o bot√£o Reiniciar esteja sempre funcional para sair do loading
    document.getElementById('btnReiniciarReporte').disabled = false;
}

function reiniciarModalReporte() {
    // Reinicia tudo (incluindo o input do n√∫mero do pedido)
    document.getElementById('problema_numPedido').value = '';
    _resetCamposReporte();
    // Re-inicializa o select para mostrar a op√ß√£o padr√£o
    problemaFerramentaSelect.innerHTML = '<option value="" disabled selected>Aguardando N¬∫ Pedido...</option><option value="Clich√™">Clich√™</option><option value="Faca">Faca</option><option value="Ambos">Ambos</option>';
    M.FormSelect.init(document.querySelectorAll('#modalReportarProblema select'), materializeSelectOptions);

    // Volta o foco para o campo do n√∫mero do pedido
    setTimeout(() => {
        document.getElementById('problema_numPedido').focus();
    }, 100);
}


function _resetReporteModal() {
    dadosInsumosReporte = null;
    
    // 1. Limpa o input do n√∫mero do pedido
    problemaNumPedidoInput.value = '';     
    // Garante que o r√≥tulo volte ao normal (1. Informe o N¬∫ do Pedido)
    M.updateTextFields();     
    
    // 2. Limpa e desabilita o Select de Ferramenta
    problemaFerramentaSelect.value = '';
    problemaFerramentaSelect.disabled = true;     
    problemaFerramentaSelect.innerHTML = '<option value="" disabled selected>Aguardando N¬∫ Pedido...</option><option value="Clich√™">Clich√™</option><option value="Faca">Faca</option><option value="Ambos">Ambos</option>';
    
    // 3. Limpa demais selects/textareas (ajuste de acordo com seu helper _resetCamposReporte)
    document.getElementById('problema_id_lamina').innerHTML = '<option value="" disabled>Selecione (Jogo Inteiro)</option>';
    document.getElementById('problema_tipo_cliche').innerHTML = '<option value="" disabled selected>Escolha o Tipo de Problema</option>';
    document.getElementById('problema_tipo_faca').innerHTML = '<option value="" disabled selected>Escolha o Tipo de Problema</option>';
    document.getElementById('problema_descricao_cliche').value = '';
    document.getElementById('problema_descricao_faca').value = '';

    // 4. Limpa e Esconde Displays
    document.getElementById('faca_modelo_display').textContent = '---';
    document.getElementById('faca_id_unico_display').textContent = '---';
    document.getElementById('faca_info_display').style.backgroundColor = '#f9f9f9';
    document.getElementById('bloco_cliche').style.display = 'none';
    document.getElementById('bloco_faca').style.display = 'none';
    document.getElementById('bloco_detalhes_pedido').style.display = 'none';
    
    // üöÄ NOVO: Limpar campo ID Clich√™
    document.getElementById('cliche_id_display').textContent = '---';

    // 5. Habilita Bot√µes Corretos
    problemaBtnConfirm.disabled = true;
    document.getElementById('btnReiniciarReporte').disabled = false;
    
    M.FormSelect.init(document.querySelectorAll('#modalReportarProblema select'), materializeSelectOptions);
    M.updateTextFields();
}

// NOVO: Altere a fun√ß√£o 'abrirModalReportarProblema' para chamar o novo reset
function abrirModalReportarProblema() {
    _resetReporteModal(); // Limpa TUDO, inclusive o N¬∫ do Pedido
    problemaModalInstance.open();
    // M.updateTextFields(); // Comentado, pois o _resetReporteModal j√° chama.
    // O foco agora √© no input do n√∫mero do pedido, que est√° limpo.
}

function handlePedidoReporteChange() {
    const numPedido = problemaNumPedidoInput.value.trim();
    if (numPedido.length < 5 || isNaN(parseInt(numPedido))) {
        // Se a busca for inv√°lida, apenas reseta o restante (SEM ACIONAR EVENTOS)
        _resetCamposReporte(); // Chama o helper que limpa s√≥ os campos dependentes
        return;
    }

    // 1. Reset e Mostra Loading
    _showLoadingReporte(true);
    document.getElementById('problema_ferramenta').value = '';
    document.getElementById('bloco_cliche').style.display = 'none';
    document.getElementById('bloco_faca').style.display = 'none';
    problemaFerramentaSelect.disabled = true;
    M.FormSelect.init(document.querySelectorAll('#modalReportarProblema select'), materializeSelectOptions);

    // 2. Busca Dados
    executarComRetry(
        'getDadosInsumosParaReporte',
        [numPedido],
        (data) => {
            _showLoadingReporte(false);
            if (!data || data.erro || !data.numPedido) {
                showErrorToast(data.erro || `Pedido ${numPedido} n√£o encontrado, j√° cancelado/conclu√≠do ou erro de servidor.`);
                _resetCamposReporte(); // Chama o helper
                return;
            }
            // SUCESSO
            dadosInsumosReporte = data;
            _preencherDadosReporte(data);
        },
        (erro) => {
            _showLoadingReporte(false);
            showErrorToast(`Erro ao buscar dados: ${erro.message}`);
            _resetCamposReporte(); // Chama o helper
        }
    );
}

function _resetCamposReporte() {
    // Limpa o estado da busca anterior
    dadosInsumosReporte = null;
    
    // Desabilita o select de ferramenta
    problemaFerramentaSelect.value = '';
    problemaFerramentaSelect.disabled = true; // Mant√©m desabilitado at√© nova busca

    // Limpa e esconde os blocos
    document.getElementById('problema_id_lamina').innerHTML = '<option value="" disabled>Selecione (Jogo Inteiro)</option>';
    document.getElementById('problema_tipo_cliche').innerHTML = '<option value="" disabled selected>Escolha o Tipo de Problema</option>';
    document.getElementById('problema_tipo_faca').innerHTML = '<option value="" disabled selected>Escolha o Tipo de Problema</option>';
    document.getElementById('problema_descricao_cliche').value = '';
    document.getElementById('problema_descricao_faca').value = '';
    document.getElementById('bloco_cliche').style.display = 'none';
    document.getElementById('bloco_faca').style.display = 'none';
    document.getElementById('bloco_detalhes_pedido').style.display = 'none';
    
    // Limpa Display da Faca/Clich√™
    document.getElementById('faca_modelo_display').textContent = '---';
    document.getElementById('faca_id_unico_display').textContent = '---';
    document.getElementById('faca_info_display').style.backgroundColor = '#f9f9f9';
    // üöÄ NOVO: Limpa campo ID Clich√™
    document.getElementById('cliche_id_display').textContent = '---';
    
    problemaBtnConfirm.disabled = true;
    // Re-inicializa selects ap√≥s mudan√ßa de conte√∫do/disabled
    M.FormSelect.init(document.querySelectorAll('#modalReportarProblema select'), materializeSelectOptions);
    M.updateTextFields();
}

function _preencherDadosReporte(data) {
    const isClich√™Nulo = !data.idCliche || data.idCliche === 'N/A';
    const isFacaNulo = !data.codFacaModelo || data.codFacaModelo === 'N/A';
    
    // Status atual do pedido (para verificar bloqueio de Aguardando Insumos)
    const statusAtual = todosPedidos.find(p => p.numPedido == data.numPedido)?.status || "";
    if (statusAtual.includes("Aguardando")) {
        showErrorToast("Este pedido j√° est√° em status de espera. Cancele e recrie a solicita√ß√£o se necess√°rio.");
        return;
    }
    // --- NOVO: Preencher Detalhes do Pedido ---
    document.getElementById('detalhes_pedido_num').textContent = data.numPedido;
    document.getElementById('detalhes_pedido_cliente').textContent = data.cliente || 'N/A';
    document.getElementById('detalhes_pedido_descricao').textContent = data.descricao || 'N/A';
    document.getElementById('detalhes_pedido_status').textContent = data.statusPedido || 'N/A';
    document.getElementById('bloco_detalhes_pedido').style.display = 'block';

    // --- 1. Preencher Selects de Tipo de Problema (Clich√™ e Faca) ---
    const selectTipoCliche = document.getElementById('problema_tipo_cliche');
    const selectTipoFaca = document.getElementById('problema_tipo_faca');
    selectTipoCliche.innerHTML = gerarOptions(data.tiposProblemaCliche, null, "Escolha o Tipo de Problema");
    selectTipoFaca.innerHTML = gerarOptions(data.tiposProblemaFaca, null, "Escolha o Tipo de Problema");
    
    // --- 2. Preencher Select de L√¢minas (Clich√™) ---
    const selectLamina = document.getElementById('problema_id_lamina');
    selectLamina.innerHTML = '<option value="" disabled>Selecione (Jogo Inteiro)</option>';
    if (!isClich√™Nulo && data.laminasDoCliche && data.laminasDoCliche.length > 0) {
        data.laminasDoCliche.forEach(lamina => {
            selectLamina.innerHTML += `<option value="${lamina.idLamina}">Esta√ß√£o ${lamina.estacao}: ${lamina.tipoLamina} (${lamina.statusLamina})</option>`;
        });
    } else if (!isClich√™Nulo) {
        selectLamina.innerHTML += '<option value="" disabled selected>Clich√™ sem l√¢minas cont√°veis cadastradas!</option>';
    }
    
    // üöÄ NOVO: Preencher campo ID Clich√™
    document.getElementById('cliche_id_display').textContent = data.idCliche || 'N/A';


    // --- 3. Preencher Display da Faca ---
    const facaDisplay = document.getElementById('faca_info_display');
    if (!isFacaNulo) {
        document.getElementById('faca_modelo_display').textContent = data.codFacaModelo;
        document.getElementById('faca_id_unico_display').textContent = data.idUnicoFaca;
        facaDisplay.style.backgroundColor = '#E8F5E9'; // Light Green background
        if (data.codFacaModelo.toUpperCase().includes('DIGITAL')) {
            facaDisplay.style.backgroundColor = '#E1F5FE'; // Light Blue for Digital
        }
    }

    const tituloCliche = document.getElementById('problema_cliche_titulo_id');
    if (tituloCliche) {
        if (!isClich√™Nulo) {
            tituloCliche.innerHTML = `Problema no Clich√™ | ID: <strong>${data.idCliche}</strong>`;
        } else {
             tituloCliche.textContent = 'Problema no Clich√™ (ID n√£o encontrado)';
        }
    }

    // --- 4. Habilitar a sele√ß√£o de Ferramenta ---
    problemaFerramentaSelect.value = ''; // Reset selection
    problemaFerramentaSelect.disabled = false;
    
    // Exibe mensagem se ambos insumos estiverem nulos
    if (isClich√™Nulo && isFacaNulo) {
        showErrorToast("Erro: O pedido n√£o tem Clich√™ ou Faca vinculados para reporte.");
        problemaFerramentaSelect.disabled = true;
    }

    M.FormSelect.init(document.querySelectorAll('#modalReportarProblema select'), materializeSelectOptions);
    M.updateTextFields();
}

function handleFerramentaReporteChange() {
    const ferramenta = problemaFerramentaSelect.value;
    const blocoCliche = document.getElementById('bloco_cliche');
    const blocoFaca = document.getElementById('bloco_faca');
    const isClich√™Nulo = dadosInsumosReporte && (!dadosInsumosReporte.idCliche || dadosInsumosReporte.idCliche === 'N/A');
    const isFacaNulo = dadosInsumosReporte && (!dadosInsumosReporte.codFacaModelo || dadosInsumosReporte.codFacaModelo === 'N/A');

    blocoCliche.style.display = 'none';
    blocoFaca.style.display = 'none';
    problemaBtnConfirm.disabled = true;

    if (ferramenta === 'Clich√™' || ferramenta === 'Ambos') {
        if (isClich√™Nulo) {
            showErrorToast("Este pedido n√£o tem um ID de Clich√™ vinculado ao produto!");
        } else {
            blocoCliche.style.display = 'block';
        }
    }
    if (ferramenta === 'Faca' || ferramenta === 'Ambos') {
        if (isFacaNulo) {
            showErrorToast("Este pedido n√£o tem um MODELO de Faca vinculado ao produto!");
        } else {
            blocoFaca.style.display = 'block';
        }
    }
    
    checkReporteInputs();
}

function checkReporteInputs() {
    const ferramenta = problemaFerramentaSelect.value;
    const isClicheBlocoVisivel = document.getElementById('bloco_cliche').style.display === 'block';
    const isFacaBlocoVisivel = document.getElementById('bloco_faca').style.display === 'block';

    let validCliche = true;
    let validFaca = true;

    if (isClicheBlocoVisivel) {
        const tipoCliche = document.getElementById('problema_tipo_cliche').value;
        const descCliche = document.getElementById('problema_descricao_cliche').value.trim();
        validCliche = !!tipoCliche && descCliche.length >= 5;
    }

    if (isFacaBlocoVisivel) {
        const tipoFaca = document.getElementById('problema_tipo_faca').value;
        const descFaca = document.getElementById('problema_descricao_faca').value.trim();
        validFaca = !!tipoFaca && descFaca.length >= 5;
    }

    const isDataFetched = !!dadosInsumosReporte;
    
    problemaBtnConfirm.disabled = !(isDataFetched && validCliche && validFaca && (isClicheBlocoVisivel || isFacaBlocoVisivel));
}

function confirmarReporteProblema() {
    const problemaBtnConfirm = document.getElementById('btnConfirmarReporteProblema');
    const problemaNumPedidoInput = document.getElementById('problema_numPedido');
    const problemaFerramentaSelect = document.getElementById('problema_ferramenta');

    const textareaCliche = document.getElementById('problema_descricao_cliche'); 
    const textareaFaca = document.getElementById('problema_descricao_faca');

    const selectTipoCliche = document.getElementById('problema_tipo_cliche');
    const selectTipoFaca = document.getElementById('problema_tipo_faca');
    const selectLaminas = document.getElementById('problema_id_lamina');

    // --- FUN√á√ÉO NOVA ---
    function estaVisivel(el) {
        return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);
    }

    const isClicheBlocoVisivel = estaVisivel(document.getElementById('bloco_cliche'));
    const isFacaBlocoVisivel = estaVisivel(document.getElementById('bloco_faca'));

    problemaBtnConfirm.disabled = true;
    _showLoadingReporte(true);

    const ferramenta = problemaFerramentaSelect.value;

    const descCliche = (textareaCliche.value || "").trim();
    const descFaca = (textareaFaca.value || "").trim();

    const valTipoCliche = selectTipoCliche.value || "";
    const valTipoFaca = selectTipoFaca.value || "";

    let valLaminas = [];
    if (isClicheBlocoVisivel) {
        const instance = M.FormSelect.getInstance(selectLaminas);
        if (instance) valLaminas = instance.getSelectedValues();
    }

    const dados = {
        numPedido: problemaNumPedidoInput.value.trim(),
        ferramenta: ferramenta,

        idCliche: dadosInsumosReporte?.idCliche || "",
        idUnicoFaca: dadosInsumosReporte?.idUnicoFaca || "",
        codFacaModelo: dadosInsumosReporte?.codFacaModelo || "",

        tipoCliche: valTipoCliche,
        descCliche: descCliche,   // <---- ALTERADO
        idsLaminas: valLaminas,

        tipoFaca: valTipoFaca,
        descFaca: descFaca        // <---- ALTERADO
    };

¬† ¬† // --- 4. VALIDA√á√ÉO ---
¬† ¬† if (!dados.numPedido || !dados.ferramenta) {
¬† ¬† ¬† ¬† showErrorToast("Erro: N√∫mero do pedido e ferramenta s√£o obrigat√≥rios.");
¬† ¬† ¬† ¬† problemaBtnConfirm.disabled = false;
¬† ¬† ¬† ¬† _showLoadingReporte(false);
¬† ¬† ¬† ¬† return;
¬† ¬† }
¬† ¬† 
¬† ¬† if (isClicheBlocoVisivel) {
¬† ¬† ¬† ¬† if (!dados.tipoCliche) { 
¬† ¬† ¬† ¬† ¬† ¬† showErrorToast("Erro: Selecione o TIPO do problema do Clich√™.");
¬† ¬† ¬† ¬† ¬† ¬† problemaBtnConfirm.disabled = false;
¬† ¬† ¬† ¬† ¬† ¬† _showLoadingReporte(false);
¬† ¬† ¬† ¬† ¬† ¬† return;
¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† if (descCliche.length < 5) {
¬† ¬† ¬† ¬† ¬† ¬† showErrorToast(`Erro: A descri√ß√£o do problema do Clich√™ deve ter pelo menos 5 caracteres. (Voc√™ digitou: ${descCliche.length})`);
¬† ¬† ¬† ¬† ¬† ¬† problemaBtnConfirm.disabled = false;
¬† ¬† ¬† ¬† ¬† ¬† _showLoadingReporte(false);
¬† ¬† ¬† ¬† ¬† ¬† return;
¬† ¬† ¬† ¬† }
¬† ¬† }
¬† ¬† 
¬† ¬† if (isFacaBlocoVisivel) {
¬† ¬† ¬† ¬† if (!dados.tipoFaca) {
¬† ¬† ¬† ¬† ¬† ¬† showErrorToast("Erro: Selecione o TIPO do problema da Faca.");
¬† ¬† ¬† ¬† ¬† ¬† problemaBtnConfirm.disabled = false;
¬† ¬† ¬† ¬† ¬† ¬† _showLoadingReporte(false);
¬† ¬† ¬† ¬† ¬† ¬† return;
¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† if (descFaca.length < 5) {
¬† ¬† ¬† ¬† ¬† ¬† showErrorToast(`Erro: A descri√ß√£o do problema da Faca deve ter pelo menos 5 caracteres. (Voc√™ digitou: ${descFaca.length})`);
¬† ¬† ¬† ¬† ¬† ¬† problemaBtnConfirm.disabled = false;
¬† ¬† ¬† ¬† ¬† ¬† _showLoadingReporte(false);
¬† ¬† ¬† ¬† ¬† ¬† return;
¬† ¬† ¬† ¬† }
¬† ¬† }

¬† ¬† // --- 5. ENVIO ---
¬† ¬† console.log("üì§ Enviando para o backend:", JSON.stringify(dados, null, 2));

¬† ¬† showSuccessToast("Registrando problema, aguarde...");

¬† ¬† google.script.run
¬† ¬† ¬† ¬† .withSuccessHandler(onSucessoReporte)
¬† ¬† ¬† ¬† .withFailureHandler(onFalhaReporte)
¬† ¬† ¬† ¬† .registrarProblemaProducaoIntegrado(dados);
}


function onSucessoReporte(msg) {
    showSuccessToast(msg);
    problemaModalInstance.close();
    _showLoadingReporte(false);
    problemaBtnConfirm.disabled = false;
    refreshPedidos(); // Atualiza a fila de produ√ß√£o
}

function onFalhaReporte(erro) {
    showErrorToast(`Falha: ${erro.message}`);
    _showLoadingReporte(false);
    problemaBtnConfirm.disabled = false;
}


// [SUBSTITUA A FUN√á√ÉO INTEIRA]

function handleConfirmarConsumoSobra() {
¬† const numPedido = document.getElementById('sobra-num-pedido').value;
¬† const codProduto = document.getElementById('sobra-cod-produto').textContent;
¬† const qtdConsumir = document.getElementById('sobra-qtd-consumir').value;
¬†¬†
¬† const qtdNum = parseFloat(qtdConsumir) || 0;
¬† if (qtdNum <= 0) {
¬† ¬† showErrorToast("A quantidade a consumir deve ser maior que zero.");
¬† ¬† return;
¬† }
¬†¬†
¬† const btnConfirm = document.getElementById('btn-confirmar-consumo-sobra');
  // Salva o texto original do bot√£o
¬† const btnOriginalText = btnConfirm.innerHTML; 
¬†¬†
¬† // 1. Mostrar estado de loading SEM fechar o modal
¬† btnConfirm.disabled = true;
¬† btnConfirm.innerHTML = 'Processando... <i class="material-icons right">hourglass_top</i>';
¬†¬†
¬† google.script.run
¬† ¬† .withSuccessHandler(function(resposta) {
      // 2. SUCESSO: Agora sim, fecha o modal e atualiza
¬† ¬† ¬† modalConsumirSobraInstance.close();
¬† ¬† ¬† btnConfirm.disabled = false; // Restaura para a pr√≥xima vez
      btnConfirm.innerHTML = btnOriginalText;

¬† ¬† ¬† if (resposta.sucesso) {
¬† ¬† ¬† ¬† showSuccessToast(resposta.mensagem);
¬† ¬† ¬† ¬† refreshPedidos();¬†
¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† showErrorToast(resposta.mensagem); // Mostra o erro (ex: saldo insuficiente)
¬† ¬† ¬† }
¬† ¬† })
¬† ¬† .withFailureHandler(function(error) {
      // 3. FALHA: Restaura o bot√£o e MANT√âM o modal aberto
¬† ¬† ¬† btnConfirm.disabled = false;
¬† ¬† ¬† btnConfirm.innerHTML = btnOriginalText;
¬† ¬† ¬† showErrorToast(error.message || error);
¬† ¬† })
¬† ¬† .consumirSobraEstoque(codProduto, qtdNum, numPedido);
}
    
    </script>
</body>
</html>
